<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yuqiao Yang">

<title>Macroeconometrics Research Report - An Evidence-based Forecast: Gold as a Traditional Safe-Haven Investment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Macroeconometrics Research Report</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#data-and-data-properties" id="toc-data-and-data-properties" class="nav-link" data-scroll-target="#data-and-data-properties"><span class="header-section-number">2</span> Data and Data Properties</a></li>
  <li><a href="#plots-of-all-variables" id="toc-plots-of-all-variables" class="nav-link" data-scroll-target="#plots-of-all-variables"><span class="header-section-number">3</span> Plots of all variables</a></li>
  <li><a href="#modeling-and-hypothesis" id="toc-modeling-and-hypothesis" class="nav-link" data-scroll-target="#modeling-and-hypothesis"><span class="header-section-number">4</span> Modeling and Hypothesis</a>
  <ul class="collapse">
  <li><a href="#matrix-notation-for-the-model" id="toc-matrix-notation-for-the-model" class="nav-link" data-scroll-target="#matrix-notation-for-the-model"><span class="header-section-number">4.1</span> Matrix Notation for the model:</a></li>
  <li><a href="#likelihood-function" id="toc-likelihood-function" class="nav-link" data-scroll-target="#likelihood-function"><span class="header-section-number">4.2</span> Likelihood Function</a></li>
  <li><a href="#prior-distribution" id="toc-prior-distribution" class="nav-link" data-scroll-target="#prior-distribution"><span class="header-section-number">4.3</span> Prior Distribution</a>
  <ul class="collapse">
  <li><a href="#natural-conjugate-prior-distribution" id="toc-natural-conjugate-prior-distribution" class="nav-link" data-scroll-target="#natural-conjugate-prior-distribution"><span class="header-section-number">4.3.1</span> Natural-conjugate prior distribution</a></li>
  </ul></li>
  <li><a href="#benchmark-model-with-minnesota-prior" id="toc-benchmark-model-with-minnesota-prior" class="nav-link" data-scroll-target="#benchmark-model-with-minnesota-prior"><span class="header-section-number">4.4</span> Benchmark model with Minnesota prior</a>
  <ul class="collapse">
  <li><a href="#bayesian-estimations" id="toc-bayesian-estimations" class="nav-link" data-scroll-target="#bayesian-estimations"><span class="header-section-number">4.4.1</span> Bayesian Estimations</a></li>
  <li><a href="#gibbs-sampler-function-proofing" id="toc-gibbs-sampler-function-proofing" class="nav-link" data-scroll-target="#gibbs-sampler-function-proofing"><span class="header-section-number">4.4.2</span> Gibbs sampler: Function Proofing</a></li>
  </ul></li>
  <li><a href="#the-extended-model-laplace-distribution-of-error-term" id="toc-the-extended-model-laplace-distribution-of-error-term" class="nav-link" data-scroll-target="#the-extended-model-laplace-distribution-of-error-term"><span class="header-section-number">4.5</span> The extended model: Laplace distribution of error term</a>
  <ul class="collapse">
  <li><a href="#bayesian-estimations-1" id="toc-bayesian-estimations-1" class="nav-link" data-scroll-target="#bayesian-estimations-1"><span class="header-section-number">4.5.1</span> Bayesian Estimations</a></li>
  <li><a href="#gibbs-sampler-function-proving" id="toc-gibbs-sampler-function-proving" class="nav-link" data-scroll-target="#gibbs-sampler-function-proving"><span class="header-section-number">4.5.2</span> Gibbs Sampler: Function proving</a></li>
  </ul></li>
  <li><a href="#stochastic-volatility-heteroskedasticity" id="toc-stochastic-volatility-heteroskedasticity" class="nav-link" data-scroll-target="#stochastic-volatility-heteroskedasticity"><span class="header-section-number">4.6</span> Stochastic Volatility Heteroskedasticity</a>
  <ul class="collapse">
  <li><a href="#matrix-notation-for-stochastic-volatility-model" id="toc-matrix-notation-for-stochastic-volatility-model" class="nav-link" data-scroll-target="#matrix-notation-for-stochastic-volatility-model"><span class="header-section-number">4.6.1</span> Matrix Notation for Stochastic Volatility model</a></li>
  <li><a href="#priors-distribution" id="toc-priors-distribution" class="nav-link" data-scroll-target="#priors-distribution"><span class="header-section-number">4.6.2</span> Priors distribution</a></li>
  <li><a href="#bayesian-estimations-2" id="toc-bayesian-estimations-2" class="nav-link" data-scroll-target="#bayesian-estimations-2"><span class="header-section-number">4.6.3</span> Bayesian Estimations</a></li>
  <li><a href="#gibbs-sampler" id="toc-gibbs-sampler" class="nav-link" data-scroll-target="#gibbs-sampler"><span class="header-section-number">4.6.4</span> Gibbs Sampler</a></li>
  </ul></li>
  <li><a href="#combinations-of-extension" id="toc-combinations-of-extension" class="nav-link" data-scroll-target="#combinations-of-extension"><span class="header-section-number">4.7</span> Combinations of Extension</a>
  <ul class="collapse">
  <li><a href="#likelihood-function-1" id="toc-likelihood-function-1" class="nav-link" data-scroll-target="#likelihood-function-1"><span class="header-section-number">4.7.1</span> Likelihood Function</a></li>
  <li><a href="#bayesian-estimations-3" id="toc-bayesian-estimations-3" class="nav-link" data-scroll-target="#bayesian-estimations-3"><span class="header-section-number">4.7.2</span> Bayesian Estimations</a></li>
  <li><a href="#gibbs-sampler-1" id="toc-gibbs-sampler-1" class="nav-link" data-scroll-target="#gibbs-sampler-1"><span class="header-section-number">4.7.3</span> Gibbs Sampler</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#empirical-analysis-model-applying-and-forecasing" id="toc-empirical-analysis-model-applying-and-forecasing" class="nav-link" data-scroll-target="#empirical-analysis-model-applying-and-forecasing"><span class="header-section-number">5</span> Empirical Analysis: Model Applying and Forecasing</a>
  <ul class="collapse">
  <li><a href="#basic-model" id="toc-basic-model" class="nav-link" data-scroll-target="#basic-model"><span class="header-section-number">5.1</span> Basic Model</a></li>
  <li><a href="#extension-model" id="toc-extension-model" class="nav-link" data-scroll-target="#extension-model"><span class="header-section-number">5.2</span> Extension Model</a>
  <ul class="collapse">
  <li><a href="#laplace-ditribution-of-errors" id="toc-laplace-ditribution-of-errors" class="nav-link" data-scroll-target="#laplace-ditribution-of-errors"><span class="header-section-number">5.2.1</span> Laplace Ditribution of errors</a></li>
  <li><a href="#stochastic-volatility" id="toc-stochastic-volatility" class="nav-link" data-scroll-target="#stochastic-volatility"><span class="header-section-number">5.2.2</span> Stochastic Volatility</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">6</span> Conclusion:</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">An Evidence-based Forecast: Gold as a Traditional Safe-Haven Investment</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Yuqiao Yang </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<blockquote class="blockquote">
<p><strong>Abstract.</strong> This research aims to explore future trends in Gold prices as a traditional safe-haven investment using a Bayesian VARs model. In the wake of the 2008 financial crisis and especially the 2019 global Covid-19 pandemic, the world economy appears to be on the brink of a looming risk: a world-wide economic recession. The concern over the risk of investment returns has become a primary focus for global investors and financial institutions. This unease has been further exacerbated by geopolitical conflicts such as the Russia-Ukraine war (2022) and the Israeli-Palestinian conflict (2023). Consequently, this research aims to provide a briefly discussion and data-driven forecast of traditional safe-haven assets: Gold, under current circumstances. Factors considered include emerging safe-haven investments, risk-free investment assets, comparable investments, market returns, inflation on both demand and supply sides, broad money supply (M2), interest rates, unemployment rates and market volatility.</p>
<p><strong>Keywords.</strong> Bayesian VARs, Gold price, Inflation, Interest rate, Unemployment, US Bond Yield, Safe-haven Assets, Forecasting, Volatility, R, Quarto.</p>
</blockquote>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p><strong>Objective:</strong></p>
<p>This research project aims to provide a monthly based, data-driven forecast of Gold price(USD) in two years, utilizing a Bayesian VARs model.</p>
<p><strong>Question:</strong></p>
<p>Gold as a traditional safe-haven asset, what are the anticipated price movements for the next year or beyond within the current environment?</p>
<p><strong>Introduction:</strong></p>
<p>Ulrich Beck introduced the concept of the risk society in the late 20th century, highlighting how humans confront entirely different systemic risks and face challenges in risk allocation under industrial society. Concurrently, globalization has reshaped the world and transformed human perceptions and experiences. Increasingly, evidence suggests that humanity is entering the risk society as described by Beck. Globalization encompasses not only economic, finance, technologe, and culture, but also risks. A China’s financial exchange restriction might influence Australia’s housing prices, while decisions made by the U.S. Central Bank regarding interest rates can prompt Western central banks to follow suit simultaneously. Following the 2008 financial crisis, major economies mitigated its aftermath significantly through quantitative easing monetary policies. This injection of substantial liquidity propelled economic growth steadily, leading to unprecedented prosperity in specific industries. However, the limitations of quantitative easing became apparent as the Covid-19 pandemic drew to a close. The United States and Western countries experienced unprecedented hyperinflation, coupled with indicators such as rising unemployment rates inversely correlated with inflation, conflicting long-term government bond yields with short-term treasuries, and record-breaking composite indices, signaling an impending global recession.</p>
<p>Geopolitical conflicts, such as the Russia-Ukraine war and the Israeli-Palestinian conflict, have intensified various risks. Disruptions in oil supply, blockages in key waterways, and logistical challenges in transporting goods and agricultural products have further exacerbated commodity price hikes and inflationary pressures. Consequently, mitigating or hedging investment risks has become the primary focus for global investors and financial institutions.</p>
<p>Among various safe-haven investments, gold has regained popularity as a hedge against uncertainty. This research aims to provide investors with a data-supported prediction of gold price trends over the next two years using Bayesian VAR models. The study incorporates information on comparable and emerging hedging products, market risks, returns, unemployment rates, inflation, interest rates, and other relevant parameters to construct a robust Bayesian VAR model. Ultimately, this research aids investors in identifying gold price trends and confidence intervals under different uncertainties within the current environment, thereby mitigating investment risks effectively.</p>
</section>
<section id="data-and-data-properties" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data and Data Properties</h1>
<p>To enhance the accuracy of gold price predictions, a total selection of 12 variables has been chosen, encompassing gold competitors, risk-free assets, and the Nasdaq index. From a broader macroeconomic standpoint, the variables also include inflation, the Producer Price Index (PPI), unemployment rates, crude oil prices, volatility indices, the dollar index, changes in the M2 money supply level, and federal fund effective rates.</p>
<ul>
<li><p><span class="math inline">\(GoldFutures_{t}\)</span> : Gold future price in USD per ounce, as considering the expectations in further gold price movements and high liquidity safe haven currency than real product.</p></li>
<li><p>Competitors and Substitutes for Gold ：</p>
<ul>
<li>Risk-free assets: treasury bonds
<ul>
<li><span class="math inline">\(13WeekNotes_{t}\)</span> : Considering as short-term risk free assets return. More time using in short term risk hedging in portfolio.</li>
<li><span class="math inline">\(Tbill(5Year)_{t}\)</span> : Considering as mid-term risk free assets return.</li>
<li><span class="math inline">\(Tbill(10Year)_{t}\)</span> : Considering as long-term risk free assets return.</li>
</ul></li>
</ul></li>
<li><p>Market returns as opposed to safe-haven investments：</p>
<ul>
<li><span class="math inline">\(NasdaqIndex_{t}\)</span> ：Index that include all stocks available in NASDAQ to present the market returns.</li>
</ul></li>
<li><p>Macro environment：</p>
<ul>
<li><span class="math inline">\(M2_{t}\)</span> : the Board money supply of United States cause price index goes up.</li>
<li><span class="math inline">\(Infla_{t}\)</span> : CPI Index that present whole price level changes of all goods and services in US. Gold price are highly correlated with inflation.</li>
<li><span class="math inline">\(Unemp_{t}\)</span> : unemployment rate provide by Bureau of Statistic of US to present a general environment of Labor market.</li>
<li><span class="math inline">\(CrudeOil_{t}\)</span> : to present as basic cost of production.</li>
<li><span class="math inline">\(FFERs_{t}\)</span> : As the Federal Funds Effective Rates aim to lower the inflation, decrease the M2 level.</li>
<li><span class="math inline">\(USDIndex_{t}\)</span> : to present as the purchasing power of USD cross world-wide. That increase the total amount of investors and financial institutions come into US market to earn higher returns.</li>
<li><span class="math inline">\(VolatilityIndex_{t}\)</span> : to present the risk cross whole market and expectations of further coming events.</li>
</ul></li>
</ul>
<p>After download all variables as designed, merge all data sets into a new frame and change the column names. The date of data used in this research will start at 2004-08-31 as at 2024-03-31.</p>
</section>
<section id="plots-of-all-variables" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Plots of all variables</h1>
<p>First plot all 12 variables we have:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As above, we could have all 12 variables in visualization format individually. As a quick overlook, 13 weeks bond has a similar trend with federal funds effective rates; other 2 treasury bonds move quite same; gold future, Nasdaq, crude oil price and US dollars Index have upper ward trends; Unemployment rates seems like opposite to federal rates; M2 and other 2 time series seems like stationary on mean but variance change over time.</p>
<p><strong>Correlation Table</strong></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A simple correlation provide us a basic understanding of those 12 variables. Gold future as safe-haven is highly positive correlated with Nasdaq Index.</p>
<p>Therefore, we could use ACF and PACF test to indicate whether there is autocorrelations.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Both ACF and PACF suggest that variables are highly autocorrelated except M2: Board money change rate. That might because the policy has changed in earlier 2020 and 2022. Therefore, we further need ADF test(unit root test) to feed our time series are stationary or not.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">P-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">GFutures_data</td>
<td style="text-align: right;">0.741</td>
</tr>
<tr class="even">
<td style="text-align: left;">TBill13W_data</td>
<td style="text-align: right;">0.530</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TBill5Y_data</td>
<td style="text-align: right;">0.911</td>
</tr>
<tr class="even">
<td style="text-align: left;">TBill10Y_data</td>
<td style="text-align: right;">0.902</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nasdaq_data</td>
<td style="text-align: right;">0.860</td>
</tr>
<tr class="even">
<td style="text-align: left;">M2_data</td>
<td style="text-align: right;">0.010</td>
</tr>
<tr class="odd">
<td style="text-align: left;">InflaR_data</td>
<td style="text-align: right;">0.059</td>
</tr>
<tr class="even">
<td style="text-align: left;">UnempR_data</td>
<td style="text-align: right;">0.323</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CrudeOil_data</td>
<td style="text-align: right;">0.305</td>
</tr>
<tr class="even">
<td style="text-align: left;">InterestR_data</td>
<td style="text-align: right;">0.329</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USDIndex_data</td>
<td style="text-align: right;">0.596</td>
</tr>
<tr class="even">
<td style="text-align: left;">Volatility_data</td>
<td style="text-align: right;">0.017</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="modeling-and-hypothesis" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Modeling and Hypothesis</h1>
<p>This research project based on <strong>Bayesian VARs(p) model</strong> <span class="citation" data-cites="wozniakBsvarsBayesianEstimation2022">(<a href="#ref-wozniakBsvarsBayesianEstimation2022" role="doc-biblioref">Woźniak 2022</a>)</span>to forecast the Gold price in next two years. For time <span class="math inline">\(t\)</span> = {1,2,3,…,<span class="math inline">\(T-1\)</span>,<span class="math inline">\(T\)</span>} :</p>
<span class="math display">\[\begin{aligned}
y_t &amp;= \mu_0 + A_1y_{t-1} + A_2y_{t-2}...+A_py_{t-p} +\epsilon_t\\

\epsilon_t|Y_{t-1} &amp;\sim iid \mathcal{N}_{12}(0_{12}, \Sigma)
\end{aligned}\]</span>
<p>Where N = 12 and <span class="math inline">\(y_{t}\)</span> is a vector of 12 variables at time <span class="math inline">\(t\)</span>:</p>
<span class="math display">\[\begin{aligned}

y_{t}=\begin{pmatrix}
GoldFutures_{t}\\
13WeekNotes_{t}\\
Treasurybill(5Year)_{t} \\
Treasurybill(10Year)_{t} \\
NasdaqIndex_{t} \\
M2_{t} \\
Inflation_{t} \\
Unemployment_{t}\\
CrudeOil_{t}\\
FFERs_{t} \\
USDollarIndex_{t}\\
VolatilityIndex_{t}\\
\end{pmatrix}

\end{aligned}\]</span>
<p>For time <span class="math inline">\(t\)</span> = 1,2,…..,<span class="math inline">\(T\)</span>：</p>
<ul>
<li><span class="math inline">\(y_t\)</span> is a <span class="math inline">\(N(12)\times 1\)</span> vector of observations at time <span class="math inline">\(t\)</span></li>
<li><span class="math inline">\(\mu_0\)</span> is a <span class="math inline">\(N(12)\times 1\)</span> vector of constant terms</li>
<li><span class="math inline">\(A_i\)</span> is a <span class="math inline">\(N(12)\times N(12)\)</span> matrix of autoregressive slope parameters</li>
<li><span class="math inline">\(\epsilon_t\)</span> is a <span class="math inline">\(N(12)\times 1\)</span> vector of error terms which is a multivariate white nose process(time invariant)</li>
<li><span class="math inline">\(Y_{t-1}\)</span> is the information set collecting observations on y up to time <span class="math inline">\(t-1\)</span></li>
<li><span class="math inline">\(\Sigma\)</span> is a <span class="math inline">\(N(12)\times N(12)\)</span> covariance matrix of the error term</li>
</ul>
<section id="matrix-notation-for-the-model" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="matrix-notation-for-the-model"><span class="header-section-number">4.1</span> Matrix Notation for the model:</h2>
<p>Matrix form are used to simplify the notation and the derivations. Let <span class="math inline">\(T\)</span> be the available sample size for the variable <span class="math inline">\(y\)</span> and <span class="math inline">\(K\)</span> be the sum of lags and constant term (<span class="math inline">\(K = 1 + pN\)</span>). Define a identity matrix of order <span class="math inline">\(T\)</span>, <span class="math inline">\(I_T\)</span>, as well as following matrix:</p>
<span class="math display">\[\begin{aligned}

A=
\begin{bmatrix}
\mu_{0}' \\ A_{1}' \\
A_{2} '\\.\\.\\.\\A_{p}'
\end{bmatrix}_{K \times N}

Y=
\begin{bmatrix}
y_{1}' \\ y_{2}' \\
y_{3} '\\.\\.\\.\\y_{T}'
\end{bmatrix}_{T \times N}

x_t=
\begin{bmatrix}
1 \\ y_{t-1}' \\
y_{t-2} '\\.\\.\\.\\y_{t-p}'
\end{bmatrix}_{K \times 1}

X=
\begin{bmatrix}
x_{1}' \\ x_{2}' \\
x_{3} '\\.\\.\\.\\x_{T}'
\end{bmatrix}_{T \times K}

E=
\begin{bmatrix}
\epsilon_1' \\ \epsilon_2' \\
\epsilon_3 '\\.\\.\\.\\\epsilon_T'
\end{bmatrix}_{T \times N}

\end{aligned}\]</span>
<p>Then the model can be written in a concise notation as:</p>
<span class="math display">\[\begin{aligned}

Y &amp;= X A +E
\\
\\
E|X &amp;\sim \mathcal{MN}_{T\times N}(\textbf{0},\Sigma,I_T)

\end{aligned}\]</span>
<p>Given that the density function of Matrix-variate Normal distribution <span class="math inline">\(Z\sim \mathcal{MN}_{T\times N}(M,Q,P)\)</span> is:</p>
<span class="math display">\[\begin{aligned}

\mathcal{MN}_{T\times N}(M,Q,P) &amp; =c^{-1}_{mn}exp\left\{ -\frac{1}{2}\textbf{tr}\left[ Q^{-1}\left( Z-M \right)'P^{-1}\left( Z-M \right) \right] \right\}\\
c_{mn} &amp; = \left( 2\pi \right)^{\frac{TN}{2}}det\left( Q \right)^{\frac{T}{2}}det\left( P \right)^{\frac{N}{2}}

\end{aligned}\]</span>
<p>Base on the model above, we could first turn B Vars(p) model into B Vars(1) model and easily regress to have the parameter matrix. Then we could have a <span class="math inline">\(t+h\)</span> period forward forecasting with increase of variance, in this case: <span class="math inline">\(h\)</span> = 24.</p>
<p>The main focus of estimate output is the conditional mean of Gold price, which base on current information set <span class="math inline">\(Y_{t-1}\)</span>. It provide the average mean prediction of Gold price which investors and financial institutions interested in. Moreover, 1 standard deviation and 2 standard deviation will also produced in forecasting process to provide a 68% and 95% of confidence intervals of future Gold price movements in <span class="math inline">\(h\)</span> periods base on current information set.</p>
<p>Furthermore, different prior distribution might be used to provide different level of uncertainty of current environment(information set). Compare the difference of Gold price under different priors could help to prove the Gold as a high quality safe-haven investment and increase investors and financial institutions confidence and further expectations. (Competitors for golds might also be used under different priors, such as Nasdaq Index and short to mid-term treasury bills.)</p>
</section>
<section id="likelihood-function" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="likelihood-function"><span class="header-section-number">4.2</span> Likelihood Function</h2>
<p>The model equation imply the predictive density of the data vector <span class="math inline">\(Y\)</span>. We could consider the model equation is the linear transformation of the matrix-variate normal distribution <span class="math inline">\(E\)</span>. Therefore, the data vector also follows a matrix-variate normal distribution given by:</p>
<span class="math display">\[\begin{aligned}

Y|X,A,\Sigma &amp;\sim \mathcal{MN}_{T\times N}(XA,\Sigma,I_T)

\end{aligned}\]</span>
<p>This distribution determines the shape of the likelihood function that is defined as the sampling data density:</p>
<span class="math display">\[\begin{aligned}

L(A,\Sigma | Y,X)\equiv P(Y|X,A,\Sigma)

\end{aligned}\]</span>
<p>The likelihood function for the parameters estimation (<span class="math inline">\(A,\Sigma\)</span>), and after plugging in data in place of <span class="math inline">\(Y,X\)</span>, is considered a function of parameters <span class="math inline">\(A\)</span> and <span class="math inline">\(\Sigma\)</span> is given by:</p>
<span class="math display">\[\begin{aligned}

L(A,\Sigma | Y,X) &amp;= \left( 2\pi \right)^{-\frac{TN}{2}}det\left( \Sigma \right)^{-\frac{T}{2}}exp\left\{ -\frac{1}{2}\sum_{t=1}^{T}\epsilon_{t}'\Sigma^{-1}\epsilon_{t} \right\}
\\
&amp;= \left( 2\pi \right)^{-\frac{TN}{2}}det\left( \Sigma \right)^{-\frac{T}{2}}exp\left\{ -\frac{1}{2}\sum_{t=1}^{T} \left( y_{t}-A'x_{t} \right)'\Sigma^{-1}\left( y_{t}-A'x_{t} \right)\right\}
\\
&amp;= \left( 2\pi \right)^{-\frac{TN}{2}}det\left( \Sigma \right)^{-\frac{T}{2}}exp\left\{ -\frac{1}{2}vec\left(\left( Y-XA \right)'\right)' \left( I_T\otimes \Sigma^{-1} vec\left(\left( Y-XA \right)'\right)\right)\right\}
\\
&amp;= \left( 2\pi \right)^{-\frac{TN}{2}}det\left( \Sigma \right)^{-\frac{T}{2}}exp\left\{ -\frac{1}{2}\textbf{tr}\left[\Sigma^{-1}\left( Y-XA \right)'I^{-1}_T\left(Y-XA \right) \right] \right\}
\\
&amp;= \left( 2\pi \right)^{-\frac{TN}{2}}det\left( \Sigma \right)^{-\frac{T}{2}}exp\left\{ -\frac{1}{2}\textbf{tr}\left[\Sigma^{-1}\left(Y-XA\right)'\left(Y-XA\right) \right] \right\}

\end{aligned}\]</span>
<p>Given that the trace:</p>
<ul>
<li><span class="math inline">\(\textbf{tr}\left( X \right) = \sum_{n=1}^{N}X_{nn} \ \ \ \ \text{for a }N \times N\text{ matrix }X\)</span></li>
<li><span class="math inline">\(\textbf{tr}\left( ABCD \right) = vec(D')'\left( C'\otimes A \right)vec(B)\)</span></li>
</ul>
</section>
<section id="prior-distribution" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="prior-distribution"><span class="header-section-number">4.3</span> Prior Distribution</h2>
<p>For the given model, we assume that unknown parameters have following distributions<span class="citation" data-cites="stock2001">(<a href="#ref-stock2001" role="doc-biblioref">Stock and Watson 2001</a>)</span>:</p>
<span class="math display">\[\begin{aligned}

A|\Sigma &amp;\sim \mathcal{MN}_{K\times N}(M,\Sigma,P)
\\
\Sigma &amp;\sim \mathcal{IW}_{N}(S,\nu)

\end{aligned}\]</span>
<p>where <span class="math inline">\(A_{K \times N}|\Sigma\)</span> follow a matrix-variate normal distribution:</p>
<p>- <span class="math inline">\(M\)</span> is the mean of matrix normal distribution</p>
<p>- <span class="math inline">\(\Sigma_{N \times N}\)</span>is the row specific covariance matrix</p>
<p>- <span class="math inline">\(P_{K \times K}\)</span> is the column specific covariance matrix with the density given by:</p>
<span class="math display">\[\begin{aligned}

\mathcal{MN}_{K\times N}(M,\Sigma,P) &amp; =c^{-1}_{mn}exp\left\{ -\frac{1}{2}\textbf{tr}\left[ \Sigma^{-1}\left( A-M \right)'P^{-1}\left( A-M \right) \right] \right\}\\
c_{mn} &amp; = \left( 2\pi \right)^{\frac{KN}{2}}det\left( \Sigma \right)^{\frac{K}{2}}det\left( P \right)^{\frac{N}{2}}

\end{aligned}\]</span>
<p>And <span class="math inline">\(\Sigma\)</span> follow a Inverse Wishart distribution:</p>
<p>- <span class="math inline">\(S\)</span> is N × N positive definite symmetric matrix called the scale matrix.</p>
<p>- <span class="math inline">\(\nu\)</span> &gt; N + 2 denotes degrees of freedom. with the density given by:</p>
<span class="math display">\[\begin{aligned}

\mathcal{IW}_{N}(S,\nu) &amp;= c^{-1}_{iw}det(\Sigma)^{-\frac{\nu + N+1}{2}}exp\left\{ -\frac{1}{2} \textbf{tr}\left[ \Sigma^{-1} S\right]\right\}\\
c_{iw} &amp;= 2^{\frac{\nu N}{2}}\pi^{\frac{N(N-1)}{4}}\prod_{n=1}^{N}\Gamma\left( \frac{\nu + n + 1}{2} \right)det(S)^{-\frac{\nu}{2}}

\end{aligned}\]</span>
<p>Then the joint distribution of (<span class="math inline">\(A,\Sigma\)</span>) is Normal-Inverse Wishart:</p>
<span class="math display">\[\begin{aligned}

P(A,\Sigma) &amp; \sim \mathcal{NIW}_{K \times N}(M,P,S,\nu)

\end{aligned}\]</span>
<p>with the density given by:</p>
<span class="math display">\[\begin{aligned}

P(A,\Sigma) &amp;= c^{-1}_{nw}det(\Sigma)^{-\frac{\nu + N + K + 1}{2}}\\
&amp;\times exp\left\{ -\frac{1}{2}\textbf{tr}\left[ \Sigma^{-1}\left( A-M \right)'P^{-1}\left( A-M \right) \right] \right\}\\
&amp;\times exp\left\{ -\frac{1}{2} \textbf{tr}\left[ \Sigma^{-1} S\right]\right\}
\\
\\
c_{nw} &amp;= 2^{\frac{N(K + \nu)}{2}}\pi^{\frac{N(N + 2K -1)}{4}}[\prod_{n=1}^{N}\Gamma\left( \frac{\nu + 1 - n}{2} \right)]det\left( P \right)^{\frac{N}{2}}det(S)^{-\frac{\nu}{2}}

\end{aligned}\]</span>
<section id="natural-conjugate-prior-distribution" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="natural-conjugate-prior-distribution"><span class="header-section-number">4.3.1</span> Natural-conjugate prior distribution</h3>
<p>Leads to joint posterior distribution for (<span class="math inline">\(A,\Sigma\)</span>) has the same form as prior:</p>
<span class="math display">\[\begin{aligned}

P(A,\Sigma) &amp;= P(A|\Sigma)P(\Sigma)
\\
A|\Sigma &amp;\sim \mathcal{MN}_{K\times N}(\underline{A},\Sigma,\underline{V})
\\
\Sigma &amp;\sim \mathcal{IW}_{N}(\underline{S}, \underline{\nu})

\end{aligned}\]</span>
<p>with the <strong>kernel</strong> given by:</p>
<span class="math display">\[\begin{aligned}

P(A,\Sigma) &amp;\propto \det(\Sigma)^{-\frac{N+K+\underline{\nu}+1}{2}} \\
&amp;\times exp\{-\frac{1}{2}tr[\Sigma^{-1}(A-\underline{A}) \underline{V}^{-1}(A-\underline{A})]\} \\
&amp;\times exp\{-\frac{1}{2}tr[\Sigma^{-1}\underline{S}]\}

\end{aligned}\]</span>
</section>
</section>
<section id="benchmark-model-with-minnesota-prior" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="benchmark-model-with-minnesota-prior"><span class="header-section-number">4.4</span> Benchmark model with Minnesota prior</h2>
<p>In real life, macroeconomic variables are more likely being unit-root non stationary and are well-characterized by a multivariate random walk process：</p>
<span class="math display">\[\begin{aligned}

y_{t} = y_{t-1} + \epsilon_t

\end{aligned}\]</span>
<p>Therefore, our benchmark model uses Minnesota prior(1984) based on random walk process for our Bayesian forecasting.</p>
<p>Set the prior mean <span class="math inline">\(A\)</span> to:</p>
<span class="math display">\[\begin{aligned}

\underline{A}=\left[ 0_{N\times1} \ \ \ \  I_{N} \ \ \ \ \ 0_{N\times(p-1)N} \right]'

\end{aligned}\]</span>
<p>which means the mean of first lag equal to 1 and mean of constant term and other lags are 0.</p>
<p>Set the column specific prior covariance of <span class="math inline">\(A\)</span> (prior shrinkage)to:</p>
<span class="math display">\[\begin{aligned}

\underline{V} = diag\left[ \kappa_{2} \quad \kappa_{1}(\textbf{P} ^{-2}\otimes \textbf{i}^{'}_{N}) \right]

\end{aligned}\]</span>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(\textbf{P}\)</span> is the list of legs, <span class="math inline">\(\textbf{P} \ \ \ =\left[ 1 \quad 2 \quad 3\quad ... \quad p \right]\)</span></p></li>
<li><p><span class="math inline">\(\textbf{i}^{'}_{N}\)</span> is a <span class="math inline">\(N \times 1\)</span> vector of ones</p></li>
<li><p><span class="math inline">\(\kappa_{1}\)</span>: overall shrinkage level for autoregressive slopes</p></li>
<li><p><span class="math inline">\(\kappa_{2}\)</span>: overall shrinkage for the constant term</p></li>
</ul>
<p>therefore, we could have the variance of <span class="math inline">\(A\)</span>:</p>
<p><span class="math display">\[
VAR\left[ vec\left( A \right) \right]\quad = \quad \Sigma \ \ \otimes \ \ \underline{V}
\]</span></p>
<section id="bayesian-estimations" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="bayesian-estimations"><span class="header-section-number">4.4.1</span> Bayesian Estimations</h3>
<p>Based on Bayes’ Theorem:</p>
<span class="math display">\[\begin{aligned}

P(A|B) &amp; =\frac{P(B|A)P(A)}{P(B)}

\end{aligned}\]</span>
<p>We could have the kernel of conditional joint posterior distribution <span class="math inline">\(P(A,\Sigma|Y,X)\)</span>, which is the proportion of the product between conditional distribution of data <span class="math inline">\(P(Y|X,A,\Sigma)\)</span> and joint prior distribution <span class="math inline">\(P(A,\Sigma)\)</span>:</p>
<span class="math display">\[\begin{aligned}

P(A,\Sigma|Y,X) &amp;= \frac{P(Y|X,A,\Sigma) \ P(A,\Sigma)}{P(Y)}\\
&amp;\propto P(Y|X,A,\Sigma) \ P(A,\Sigma)\\
&amp;\propto L(A,\Sigma | Y,X) \ P(A|\Sigma) \ P(\Sigma) \\\\

\end{aligned}\]</span>
<p>And the kernel of conditional joint posterior distribution is given by:</p>
<span class="math display">\[\begin{aligned}

P(A,\Sigma|Y,X) &amp;\propto L(A,\Sigma | Y,X) \ P(A,\Sigma)\\
&amp;\propto det(\Sigma)^{-\frac{T}{2}} \\
&amp;\times exp\{-\frac{1}{2}tr[\Sigma^{-1}(Y-XA)'(Y-XA)]\} \\
&amp;\times \det(\Sigma)^{-\frac{N+K+\underline{\nu}+1}{2}} \\
&amp;\times exp\{-\frac{1}{2}tr[\Sigma^{-1}(A-\underline{A}) \underline{V}^{-1}(A-\underline{A})]\} \\
&amp;\times exp\{-\frac{1}{2}tr[\Sigma^{-1}\underline{S}]\}

\end{aligned}\]</span>
<p>Then, the kernel could be represent as the normal-inverse Wishart distribution<span class="citation" data-cites="wozniakBsvarsBayesianEstimation2022">(<a href="#ref-wozniakBsvarsBayesianEstimation2022" role="doc-biblioref">Woźniak 2022</a>)</span>:</p>
<span class="math display">\[\begin{aligned}

P(A,\Sigma|Y,X) &amp;\sim \mathcal{NIW}_{K\times N}(\bar{A},\bar{V},\bar{S},\bar{\nu})
\\
\\
\bar{V} &amp;= (X'X + \underline{V}^{-1})^{-1} \\
\bar{A} &amp;= \bar{V}(X'Y + \underline{V}^{-1}\underline{A}) \\
\bar{\nu} &amp;= T + \underline{\nu}\\
\bar{S} &amp;= \underline{S} + Y'Y + \underline{A}'\underline{V}^{-1}\underline{A} - \bar{A}'\bar{V}^{-1}\bar{A}

\end{aligned}\]</span>
</section>
<section id="gibbs-sampler-function-proofing" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="gibbs-sampler-function-proofing"><span class="header-section-number">4.4.2</span> Gibbs sampler: Function Proofing</h3>
<p>Consider Bi-variate Gaussian random walk process:</p>
<p><span class="math display">\[
\begin{align}
y_t &amp;=
\begin{bmatrix}
y_{t,1} \\
y_{t,2}
\end{bmatrix} =
\begin{bmatrix}
y_{t-1,1} \\
y_{t-1,2}
\end{bmatrix} +
\begin{bmatrix}
\epsilon_{t,1} \\
\epsilon_{t,2}
\end{bmatrix} \\
\epsilon_{t,1} &amp;\sim \mathcal{N}(0,1)  \\
\epsilon_{t,2} &amp;\sim \mathcal{N}(0,1)
\end{align}
\]</span></p>
<p>Variables in Matrix Notation:</p>
<p><span class="math display">\[
Y = \begin{bmatrix}
y_2' \\
y_3' \\
\vdots \\
y_n'
\end{bmatrix},
\quad
X = \begin{bmatrix}
1 \quad y_1' \\
1 \quad y_2' \\
\vdots \quad \vdots \\
1 \quad y_{n-1}'
\end{bmatrix}
\]</span></p>
<p>Therefore, we could basic set up for this Bi-variate Gaussian random walk process with Minnesota prior:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>e1 <span class="ot">=</span> <span class="fu">cumsum</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">0</span>, <span class="at">sd=</span><span class="dv">1</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>e2 <span class="ot">=</span> <span class="fu">cumsum</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">0</span>, <span class="at">sd=</span><span class="dv">1</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>e  <span class="ot">=</span> <span class="fu">cbind</span>(e1,e2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Define data X, Y </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> <span class="fu">ts</span>(e[<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(e),], <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">cbind</span>(X,e[<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(e)<span class="sc">-</span><span class="dv">1</span>,])</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Test on basic model</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>N           <span class="ot">=</span> <span class="fu">ncol</span>(Y)                          <span class="co"># N=2</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>p           <span class="ot">=</span> <span class="fu">frequency</span>(Y)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>A.hat       <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">%*%</span><span class="fu">t</span>(X)<span class="sc">%*%</span>Y</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>Sigma.hat   <span class="ot">=</span> <span class="fu">t</span>(Y<span class="sc">-</span>X<span class="sc">%*%</span>A.hat)<span class="sc">%*%</span>(Y<span class="sc">-</span>X<span class="sc">%*%</span>A.hat)<span class="sc">/</span><span class="fu">nrow</span>(Y)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior distribution (with Minnesota prior)</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>kappa<span class="fl">.1</span>             <span class="ot">=</span> <span class="fl">0.02</span><span class="sc">^</span><span class="dv">2</span>                              <span class="co"># shrinkage for A1 to Ap</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>kappa<span class="fl">.2</span>             <span class="ot">=</span> <span class="dv">200</span>                                  <span class="co"># shrinkage for constant </span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>A.prior             <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(A.hat),<span class="fu">ncol</span>(A.hat))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>A.prior[<span class="dv">2</span><span class="sc">:</span>(N <span class="sc">+</span> <span class="dv">1</span>),] <span class="ot">=</span> <span class="fu">diag</span>(N)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>V.prior             <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa<span class="fl">.2</span>,kappa<span class="fl">.1</span><span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>S.prior             <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">diag</span>(Sigma.hat))</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>nu.prior            <span class="ot">=</span> N<span class="sc">+</span><span class="dv">2</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>I.matrix            <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="fu">nrow</span>(Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Function below is <code>posterior.draws</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Posterior sample draw function for basic model(posterior.draws)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>posterior.draws       <span class="ot">=</span> <span class="cf">function</span> (S, Y, X){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># normal-inverse Wishard posterior parameters</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    V.bar.inv         <span class="ot">=</span> <span class="fu">t</span>(X)<span class="sc">%*%</span>X <span class="sc">+</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">diag</span>(V.prior))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    V.bar             <span class="ot">=</span> <span class="fu">solve</span>(V.bar.inv)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    A.bar             <span class="ot">=</span> V.bar<span class="sc">%*%</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>Y <span class="sc">+</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">diag</span>(V.prior))<span class="sc">%*%</span>A.prior)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    nu.bar            <span class="ot">=</span> <span class="fu">nrow</span>(Y) <span class="sc">+</span> nu.prior</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    S.bar             <span class="ot">=</span> S.prior <span class="sc">+</span> <span class="fu">t</span>(Y)<span class="sc">%*%</span>Y <span class="sc">+</span> <span class="fu">t</span>(A.prior)<span class="sc">%*%</span><span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">diag</span>(V.prior))<span class="sc">%*%</span>A.prior <span class="sc">-</span> <span class="fu">t</span>(A.bar)<span class="sc">%*%</span>V.bar.inv<span class="sc">%*%</span>A.bar</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    S.bar.inv         <span class="ot">=</span> <span class="fu">solve</span>(S.bar)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># posterior draws </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    Sigma.posterior   <span class="ot">=</span> <span class="fu">rWishart</span>(<span class="dv">1</span>, <span class="at">df=</span>nu.bar, <span class="at">Sigma=</span>S.bar.inv)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    Sigma.posterior   <span class="ot">=</span> <span class="fu">apply</span>(Sigma.posterior,<span class="dv">3</span>,solve)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    Sigma.posterior   <span class="ot">=</span> <span class="fu">array</span>(Sigma.posterior,<span class="fu">c</span>(N,N,S))</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    A.posterior       <span class="ot">=</span> <span class="fu">array</span>(<span class="fu">rnorm</span>(<span class="fu">prod</span>(<span class="fu">c</span>(<span class="fu">dim</span>(A.bar),S))),<span class="fu">c</span>(<span class="fu">dim</span>(A.bar),S))</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    L                 <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">chol</span>(V.bar))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>      A.posterior[,,s]<span class="ot">=</span> A.bar <span class="sc">+</span> L<span class="sc">%*%</span>A.posterior[,,s]<span class="sc">%*%</span><span class="fu">chol</span>(Sigma.posterior[,,s])</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    output            <span class="ot">=</span> <span class="fu">list</span>(<span class="at">A.posterior=</span>A.posterior, <span class="at">Sigma.posterior=</span>Sigma.posterior)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(output)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The posterior mean of the <span class="math inline">\(A\)</span> is:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;">A</th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;">Simulation Parameter Y1</th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;">Simulation Parameter Y2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Constant term</td>
<td style="text-align: center;">0.0610</td>
<td style="text-align: center;">0.0807</td>
</tr>
<tr class="even">
<td style="text-align: center;">Y1 lag</td>
<td style="text-align: center;">0.9893</td>
<td style="text-align: center;">0.0048</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Y2 lag</td>
<td style="text-align: center;">0.0024</td>
<td style="text-align: center;">0.9957</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<ul>
<li>The posterior mean of the <span class="math inline">\(\Sigma\)</span> is:</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;">Sigma</th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;">Simulation Parameter Y1</th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;">Simulation Parameter Y2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Y1 lag</td>
<td style="text-align: center;">1.0052</td>
<td style="text-align: center;">0.1171</td>
</tr>
<tr class="even">
<td style="text-align: center;">Y2 lag</td>
<td style="text-align: center;">0.1171</td>
<td style="text-align: center;">0.9771</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section>
</section>
<section id="the-extended-model-laplace-distribution-of-error-term" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="the-extended-model-laplace-distribution-of-error-term"><span class="header-section-number">4.5</span> The extended model: Laplace distribution of error term</h2>
<p>The <strong>Basic Model</strong> is the standard VARs model that assume the error terms <span class="math inline">\(U\)</span> are independent and identically distributed(<span class="math inline">\(iid\)</span>) as <span class="math inline">\(U \ \sim N_{TN}(0 \ , \ \Sigma)\)</span>. In other formation, it could be presented as <span class="math inline">\(vec(U) \ \sim N(0 \ , \ \Sigma \ \otimes \  I_{T})\)</span>. Where <span class="math inline">\(\Sigma\)</span> is a <span class="math inline">\(N\times N\)</span> cross sectional covariance matrix, <span class="math inline">\(I_{t}\)</span> is a <span class="math inline">\(T\times T\)</span> identity matrix present serial covariance, <span class="math inline">\(\otimes\)</span> is the Kronecker product and the operator <span class="math inline">\(vec(.)\)</span> is vectorization that inverts the matrix into the column vector by stacking the columns.</p>
<p>Therefore, we could consider a more general serial covariance structure:</p>
<span class="math display">\[\begin{align}

vec(U) \ \sim N(0 \ , \ \Sigma \ \otimes \  \Omega)\\

\end{align}\]</span>
<p>Where:</p>
<span class="math display">\[\begin{align}

\Omega \ &amp;= \ \ diag\left[ \lambda_{1}, \lambda_{2},...,\lambda_{t}  \right]\\
\lambda \ &amp;\sim \ Exp \ (\alpha)\\

\end{align}\]</span>
<p>And then, the distribution of error terms in extension model will be <strong>Laplace distribution</strong> instead of the normally distributed errors assumption. The Laplace distribution is well-suited for describing financial anomalies due to its sharp peaks and heavy tails. Utilizing this distribution enhances the model’s robustness against anomalies, making it particularly appropriate for financial time series analysis. Given that most of our variables are financial time series data, applying a Laplace distribution to the error term is more appropriate.</p>
<p>Following <a href="https://ieeexplore.ieee.org/document/1618702">Eltoft,Kim, and Lee 2006b</a>, for covariance with a general Kronecker structure, if each <span class="math inline">\({\lambda}\)</span> has an independent exponential distribution with mean <span class="math inline">\({\alpha}\)</span>, then marginally <span class="math inline">\({U_t}\)</span> has a multivariate Laplace distribution with mean vector 0 and covariance matrix <span class="math inline">\({\alpha\Sigma}\)</span>.</p>
<span class="math display">\[\begin{align}

U &amp;\sim \ Laplace(0 \ , \  \alpha\Sigma) \\
U_t|\lambda_t &amp;\sim \mathcal{MN}(0 \ , \  \Sigma \ , \ \Omega) \\
\Omega \ &amp;= \ \ diag\left[ \lambda_{1}, \lambda_{2},...,\lambda_{t}  \right] \ = \ \lambda_t \times \textbf{I}_T\\
\lambda_t &amp;\sim \ Exp(\alpha)

\end{align}\]</span>
<p>Therefore, the prior distribution of lambda which is following exponential distribution defined as:</p>
<span class="math display">\[\begin{align}

P(\lambda_t|\alpha) &amp;= \frac{1}{\alpha}exp\{ -\frac{1}{\alpha}\lambda_t \}\\

\end{align} \]</span>
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>Following graphs describe the difference between alpha values, we could see that as the mean, alpha, increase. The rates of exponetial function decrease.</p>
</blockquote>
</blockquote>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="bayesian-estimations-1" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="bayesian-estimations-1"><span class="header-section-number">4.5.1</span> Bayesian Estimations</h3>
<p>Then, the kernel of the likelihood function could be rewritten as to:</p>
<span class="math display">\[\begin{align}

L(A,\Sigma,\Omega |Y,X) &amp;\propto \det(\Sigma)^{-\frac{T}{2}} \det(\Omega)^{-\frac{N}{2}} exp\{-\frac{1}{2}\textbf{tr}[\Sigma^{-1} (Y-XA)' \Omega^{-1} (Y-XA) ]\}\\
&amp;= \det(\Sigma)^{-\frac{T}{2}} \det(\left[ \lambda_{1}, \lambda_{2},...,\lambda_{t} \right])^{-\frac{N}{2}} exp\{-\frac{1}{2} \textbf{tr}[\Sigma^{-1} (Y-XA)' (\left[ \lambda_{1}, \lambda_{2},...,\lambda_{t} \right])^{-1} (Y-XA) ]\}\\
&amp;=\det(\Sigma)^{-\frac{T}{2}}(\prod^{T}_{t = 1} \lambda_t)^{-\frac{N}{2}} exp\left\{{-\frac{1}{2}}\sum^{T}_{t =1}{\frac{1}{\lambda_t}} \textbf{tr}[(Y_t-X_tA)' \Sigma^{-1}(Y_t-X_tA)]\right\}\\
&amp;=\det(\Sigma)^{-\frac{T}{2}}\prod^{T}_{t = 1} \lambda_t^{-\frac{N}{2}} exp\left\{{-\frac{1}{2}}\sum^{T}_{t =1}{\frac{1}{\lambda_t}} \textbf{tr}[\epsilon_t' \Sigma^{-1}\epsilon_t)]\right\}\\
&amp;=\det(\Sigma)^{-\frac{T}{2}}\prod^{T}_{t = 1}(\lambda_t^{-\frac{N}{2}} exp\left\{{-\frac{1}{2}}{\frac{1}{\lambda_t}} \textbf{tr}[\epsilon_t' \Sigma^{-1}\epsilon_t])\right\})

\end{align}\]</span>
<p>Therefore at each time t, we have the likelihood function be a proportion of lambda:</p>
<span class="math display">\[\begin{align}

\propto\det(\Sigma)^{-\frac{T}{2}}\lambda_t^{-\frac{N}{2}} exp\left\{{-\frac{1}{2}}{\frac{1}{\lambda_t}} \textbf{tr}[\epsilon_t' \Sigma^{-1}\epsilon_t])\right\}

\end{align}\]</span>
<p>For joint posteriors distribution, <span class="math inline">\(A\)</span>, <span class="math inline">\(\Sigma\)</span> can then be derived using the likelihood and the prior distributions as follows:</p>
<span class="math display">\[\begin{align}

P(A,\Sigma|Y,X) &amp;\propto L(A,\Sigma,\Omega|Y,X) \ P(A,\Sigma) \\
\\
&amp;= \det(\Sigma)^{-\frac{T}{2}} \det(\Omega)^{-\frac{N}{2}} exp\{-\frac{1}{2} \textbf{tr}[\Sigma^{-1} (Y-XA)' \Omega^{-1} (Y-XA) ]\} \\
&amp;\times \det(\Sigma)^{-\frac{N+k+\underline{\nu}+1}{2}} exp\{-\frac{1}{2}\textbf{tr}[\Sigma^{-1}(A-\underline{A})'(\underline{V})^{-1}(A-\underline{A})]\} \\
&amp;\times exp\{-\frac{1}{2}\textbf{tr}[\Sigma^{-1}\underline{S}]\} \\

&amp;= \det(\Sigma)^{-\frac{T+N+K+\underline{\nu}+1}{2}} \det(\Omega)^{-\frac{N}{2}} \\
&amp;\times exp\{-\frac{1}{2} \textbf{tr}[\Sigma^{-1}(Y'\Omega^{-1}Y - 2A'X'\Omega^{-1}Y + A'X'\Omega^{-1}XA \\
&amp;+ A'\underline{V}^{-1}A -2A'\underline{V}^{-1}\underline{A} + \underline{A}'\underline{V}^{-1}\underline{A} + \underline{S})]\}

\end{align}\]</span>
<p>The kernel also could be rearranged in the form of the <strong>Normal-inverse Wishart distribution</strong> and given by:</p>
<span class="math display">\[\begin{align}

P(A,\Sigma|Y,X,\Omega) &amp;\sim \mathcal{NIW}(\bar{A},\bar{V},\bar{S},\bar{\nu}) \\
&amp;\\
\bar{V} &amp;= (X'\Omega^{-1}X + \underline{V}^{-1})^{-1} \\
\bar{A} &amp;= \bar{V}(X'\Omega^{-1}Y + \underline{V}^{-1}\underline{A}) \\
\bar{\nu} &amp;= T + \underline{\nu}\\
\bar{S} &amp;= \underline{S} + Y'\Omega^{-1}Y + \underline{A}'\underline{V}^{-1}\underline{A} - \bar{A}'\bar{V}^{-1}\bar{A}

\end{align}\]</span>
<p>The kernel of the fully conditional posterior distribution of <span class="math inline">\(\lambda_t\)</span> is then derived as follows:</p>
<span class="math display">\[\begin{align}

P(\lambda_t|Y,X,A,\Sigma) &amp;\propto L(A,\Sigma,\lambda_t|Y,X)P(\lambda_t) \\
\\
&amp;\propto \lambda_t^{-\frac{N}{2}}exp({-\frac{1}{2}}{\frac{1}{\lambda_t}}\textbf{tr}[\epsilon_t' \Sigma^{-1}\epsilon_t]) \\
&amp;\times \frac{1}{\alpha}exp\{ -\frac{1}{\alpha}\lambda_t \}\\
&amp;\propto \lambda_t^{-\frac{N}{2}+1-1} exp\{-\frac{1}{2}[\frac{\textbf{tr}[
\epsilon_t' \Sigma^{-1}\epsilon_t]} {\lambda_t} +\frac{2}{\alpha}\lambda_t]\}

\end{align}\]</span>
<p>The above expression can be rearranged in the form of a Generalized inverse Gaussian distribution kernel as follows:</p>
<span class="math display">\[\begin{align}

\lambda_t|Y,A,\Sigma &amp;\sim \mathcal{GIG}(a,b,p) \\
\\
a &amp;=\frac{2}{\alpha} \\
b &amp;= \textbf{tr}[\epsilon_t' \Sigma^{-1}\epsilon_t] \\
p &amp;= -\frac{N}{2}+1

\end{align}\]</span>
</section>
<section id="gibbs-sampler-function-proving" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="gibbs-sampler-function-proving"><span class="header-section-number">4.5.2</span> Gibbs Sampler: Function proving</h3>
<p>The Gibbs sampler method will be applied to generate random draws from the full conditional posterior distribution:</p>
<ol type="1">
<li>Draw <span class="math inline">\(\Sigma^{(s)}\)</span> from the <span class="math inline">\(IW(\bar{S},\bar{\nu})\)</span> distribution.</li>
<li>Draw <span class="math inline">\(A^{(s)}\)</span> from the <span class="math inline">\(MN(\bar{A},\Sigma^{(s)}, \bar{V})\)</span> distribution.</li>
<li>Draw <span class="math inline">\(\lambda_t^{(s)}\)</span> from <span class="math inline">\(GIG(a,b,p)\)</span>.</li>
</ol>
<p>Repeat steps 1, step 2 and 3 for <span class="math inline">\(S_1\)</span>+<span class="math inline">\(S_2\)</span>times.</p>
<p>Discard the first draws that allowed the algorithm to converge to the stationary posterior distribution.</p>
<p>Output is <span class="math inline">\(\left\{ {A^{(s)}, \Sigma^{(s)}}, \lambda_t^{(s)}\right\}^{S_1+S_2}_{s=S_1+1}\)</span>.</p>
<p>Function below is <code>posterior.draws.extended</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>posterior.draws.extended <span class="ot">&lt;-</span> <span class="cf">function</span>(total_S,Y, X){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  S<span class="ot">=</span>total_S</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  T <span class="ot">&lt;-</span> <span class="fu">nrow</span>(Y)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">=</span> <span class="fu">ncol</span>(Y) </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">=</span> <span class="dv">1</span> <span class="sc">+</span> (p<span class="sc">*</span>N)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  lambda<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">rexp</span>(T, <span class="at">rate =</span> <span class="dv">1</span><span class="sc">/</span>alpha)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  lambda.priors <span class="ot">=</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">2</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize arrays to store posterior draws</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  Sigma.posterior.draws <span class="ot">=</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>(N,N,S))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  A.posterior.draws <span class="ot">=</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>((<span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N),N,S))</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  lambda.posterior.draws <span class="ot">=</span> <span class="fu">array</span>(<span class="cn">NA</span>,<span class="fu">c</span>(T,S<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">=</span> <span class="fu">array</span>(<span class="cn">NA</span>,<span class="fu">c</span>(T,S))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#lambda.posterior.draws &lt;- array(NA,c(T,S+1))</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (s <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>      lambda.s <span class="ot">=</span> lambda<span class="fl">.0</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>      lambda.s    <span class="ot">=</span> lambda.posterior.draws[,s]</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    Omega.inv <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span>lambda.s)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    V.bar.inv.ext   <span class="ot">=</span> <span class="fu">t</span>(X)<span class="sc">%*%</span>Omega.inv<span class="sc">%*%</span>X <span class="sc">+</span> <span class="fu">solve</span>(V.prior)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    V.bar.ext       <span class="ot">=</span> <span class="fu">solve</span>(V.bar.inv.ext)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    A.bar.ext       <span class="ot">=</span> V.bar.ext<span class="sc">%*%</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>Omega.inv<span class="sc">%*%</span>Y <span class="sc">+</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">diag</span>(V.prior))<span class="sc">%*%</span>A.prior)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    nu.bar.ext      <span class="ot">=</span> T <span class="sc">+</span> nu.prior</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    S.bar.ext       <span class="ot">=</span> S.prior <span class="sc">+</span> <span class="fu">t</span>(Y)<span class="sc">%*%</span>Omega.inv<span class="sc">%*%</span>Y <span class="sc">+</span> <span class="fu">t</span>(A.prior)<span class="sc">%*%</span><span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">diag</span>(V.prior))<span class="sc">%*%</span>A.prior <span class="sc">-</span> <span class="fu">t</span>(A.bar.ext)<span class="sc">%*%</span>V.bar.inv.ext<span class="sc">%*%</span>A.bar.ext</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    S.bar.ext.inv   <span class="ot">=</span> <span class="fu">solve</span>(S.bar.ext)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    Sigma.inv.draw <span class="ot">=</span> <span class="fu">rWishart</span>(<span class="dv">1</span>, <span class="at">df =</span> nu.bar.ext, <span class="at">Sigma =</span> S.bar.ext.inv)[,,<span class="dv">1</span>]</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    Sigma.posterior.draws[,,s] <span class="ot">=</span> <span class="fu">solve</span>(Sigma.inv.draw)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    A.posterior.draws[,,s] <span class="ot">=</span> <span class="fu">matrix</span>(mvtnorm<span class="sc">::</span><span class="fu">rmvnorm</span>(<span class="dv">1</span>, <span class="at">mean=</span><span class="fu">as.vector</span>(A.bar.ext), <span class="at">sigma =</span> Sigma.posterior.draws[,,s] <span class="sc">%x%</span> V.bar.ext), <span class="at">ncol=</span>N)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    u.t <span class="ot">=</span> Y<span class="sc">-</span>X<span class="sc">%*%</span>A.posterior.draws[,,s]</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">#    ---- loop lambda posterior ----   #</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    c                      <span class="ot">=</span> <span class="sc">-</span>N<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>          <span class="co"># N=12</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    a                      <span class="ot">=</span> <span class="dv">2</span> <span class="sc">/</span> lambda.priors<span class="sc">$</span>alpha</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>T){</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>      b                  <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">diag</span>(<span class="fu">t</span>((u.t)[x,])<span class="sc">%*%</span>Sigma.inv.draw<span class="sc">%*%</span>(u.t)[x,]))</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>      lambda.posterior.draws[x,s<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> GIGrvg<span class="sc">::</span><span class="fu">rgig</span>(<span class="dv">1</span>, <span class="at">lambda =</span> c, <span class="at">chi =</span> b, <span class="at">psi =</span> a)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    } <span class="co"># </span><span class="re">END</span><span class="co"> x loop</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  } <span class="co"># </span><span class="re">END</span><span class="co"> s loop</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#}</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  output                 <span class="ot">=</span> (<span class="fu">list</span>(<span class="at">A.posterior.exten =</span> A.posterior.draws[,,S1<span class="sc">:</span>total_S], </span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>                                <span class="at">Sigma.posterior.exten =</span> Sigma.posterior.draws[,,S1<span class="sc">:</span>total_S], </span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lambda.posterior.exten =</span> lambda.posterior.draws[,(S1<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(S<span class="sc">+</span><span class="dv">1</span>)]))</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="co"># conduct simulation</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>posterior.extended <span class="ot">=</span> <span class="fu">posterior.draws.extended</span>(<span class="at">total_S =</span> total_S, <span class="at">Y=</span>Y, <span class="at">X=</span>X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Posterior mean of the autoregressive coefficient matrix A</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Simulation_Y1</th>
<th style="text-align: right;">Simulation_Y2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Constant</td>
<td style="text-align: right;">0.0536249</td>
<td style="text-align: right;">0.1065899</td>
</tr>
<tr class="even">
<td style="text-align: left;">Y1-Lag</td>
<td style="text-align: right;">0.9909827</td>
<td style="text-align: right;">0.0086799</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Y2-Lag</td>
<td style="text-align: right;">0.0025720</td>
<td style="text-align: right;">0.9939169</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Posterior mean of the covariance matrix Sigma</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Simulation_Y1</th>
<th style="text-align: right;">Simulation_Y2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Y1-Lag</td>
<td style="text-align: right;">0.6165036</td>
<td style="text-align: right;">0.0538747</td>
</tr>
<tr class="even">
<td style="text-align: left;">Y2-Lag</td>
<td style="text-align: right;">0.0538747</td>
<td style="text-align: right;">0.6587449</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Posterior Mean of Lambda</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Lambda</td>
<td style="text-align: right;">2.007751</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="stochastic-volatility-heteroskedasticity" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="stochastic-volatility-heteroskedasticity"><span class="header-section-number">4.6</span> Stochastic Volatility Heteroskedasticity</h2>
<p>However, in the real world, the shocks are often passing to next few periods. Therefore, for the same general serial covariance structure:</p>
<span class="math display">\[\begin{align}

vec(U) \ \sim N(0 \ , \ \Sigma \ \otimes \  \Omega)\\

\end{align}\]</span>
<p>This time we have <span class="math inline">\(h_t\)</span> follows a simple stochastic volatility process:</p>
<span class="math display">\[\begin{align}

\Omega \ &amp;= diag\left[ \sigma^2_1,..., \sigma^2_T\right]\\
&amp;=\ diag\left[ exp\left\{ h_1 \right\},exp\left\{ h_2 \right\},...,exp\left\{ h_T \right\}  \right]\\
h_t &amp;= h_{t-1}+v_t\\

\end{align}\]</span>
<p>Then, the kernel of the likelihood function could be rewritten as to:</p>
<span class="math display">\[\begin{align}

L(A,\Sigma,\Omega |Y,X) &amp;\propto \det(\Sigma)^{-\frac{T}{2}} \det(\Omega)^{-\frac{N}{2}} exp\{-\frac{1}{2}\textbf{tr}[\Sigma^{-1} (Y-XA)' \Omega^{-1} (Y-XA) ]\}\\
&amp;=\det(\Sigma)^{-\frac{T}{2}}\left( \prod^{T}_{t = 1} exp\left\{ h_t \right\} \right)^{-\frac{N}{2}} exp\left\{{-\frac{1}{2}}\sum^{T}_{t =1}exp\left\{ h_t \right\}^{-1} \textbf{tr}[\epsilon_t' \Sigma^{-1}\epsilon_t)]\right\}\\
&amp;=\det(\Sigma)^{-\frac{T}{2}}exp\left\{{-\frac{N}{2}}\sum^{T}_{t =1}h_t{-\frac{1}{2}}\sum^{T}_{t =1}exp\left\{ h_t \right\}^{-1} \textbf{tr}[\epsilon_t' \Sigma^{-1}\epsilon_t)]\right\}\\

\end{align}\]</span>
<section id="matrix-notation-for-stochastic-volatility-model" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="matrix-notation-for-stochastic-volatility-model"><span class="header-section-number">4.6.1</span> Matrix Notation for Stochastic Volatility model</h3>
<p>Recall the matrix notation:</p>
<span class="math display">\[\begin{align}

Y&amp;=XA \  +  \ E\\
E|X &amp;\sim MN(0,\Sigma,\Omega) \\
\Omega \ &amp;=\ diag\left[ exp\left\{ h_1 \right\},exp\left\{ h_2 \right\},...,exp\left\{h_T \right\}  \right]\\
h_t &amp;= h_{t-1}+\sigma_{v}v_t\\

\end{align}\]</span>
<p>Given that:</p>
<span class="math display">\[\begin{align}

\epsilon_t &amp;\sim N(0,1)\\
v_t&amp;\sim N(0,1)\\

\end{align}\]</span>
<p>We could rewrite the equation as:</p>
<span class="math display">\[\begin{align}

y_t &amp;= y_{t-1}A_1 \ \ + ...+y_{t-p}A_p+\ \ exp\left\{ \frac{1}{2} h_t\right\}\epsilon_t\\
y_t - y_{t-1}A_1 \ \ + ...+y_{t-p}A_p &amp;= exp\left\{ \frac{1}{2} h_t\right\}\epsilon_t\\
y_{u.t}&amp;=exp\left\{ \frac{1}{2} h_t\right\}\epsilon_t\\

\end{align}\]</span>
<p>Then, taking the square and the logarithm of both sides of the equation, we could have:</p>
<span class="math display">\[\begin{align}

y_{u.t}&amp;=exp\left\{ \frac{1}{2} h_t\right\}\epsilon_t\\
log \ y_{u.t}^2&amp;=h_t + log \ \epsilon_t^2\\
\tilde{y}_t&amp;=h_t+\tilde{\epsilon}_t

\end{align}\]</span>
<p>And then:</p>
<span class="math display">\[\begin{align}

\tilde{\epsilon}_t&amp;\sim \log \chi^2_1

\end{align}\]</span>
<p>Define the following <span class="math inline">\(T × 1\)</span> matrices:</p>
<span class="math display">\[\begin{aligned}

\tilde{y}=
\begin{bmatrix}
\tilde{y}_1'\\ \tilde{y}_2'
\\.\\.\\.\\\tilde{y}'_T
\end{bmatrix}_{T \times 1}

h=
\begin{bmatrix}
h_{1} \\ h_{2} \\
.\\.\\.\\h_{T}
\end{bmatrix}_{T \times 1}

\tilde{\epsilon}=
\begin{bmatrix}
\tilde{\epsilon}_1'\\ \tilde{\epsilon}_2' \\
.\\.\\.\\\tilde{\epsilon}_T'
\end{bmatrix}_{T \times 1}

v=
\begin{bmatrix}
v_{1} \\ v_{2} \\
.\\.\\.\\v_{T}
\end{bmatrix}_{T \times 1}

e_{1.T}=
\begin{bmatrix}
1 \\ 0 \\
.\\.\\.\\0
\end{bmatrix}_{T \times 1}

\end{aligned}\]</span>
<p>And a <span class="math inline">\(T × T\)</span> matrix, H:</p>
<span class="math display">\[\begin{align}

H = \begin{pmatrix}
1 &amp;  &amp;  &amp;  &amp;  &amp; \\
-1 &amp; 1 &amp;  &amp;  &amp;  &amp; \\
0 &amp; -1 &amp; 1 &amp;  &amp;  &amp; \\
\vdots &amp; \ddots &amp; \ddots &amp; \ddots &amp;  &amp; \\
0 &amp; \cdots &amp; 0 &amp; -1 &amp; 1 \\
\end{pmatrix}_{T \times T}

\end{align}\]</span>
<p>Therefore, we could have the simple matrix notation for Stochastic Volatility model:</p>
<span class="math display">\[\begin{align}

\tilde{y}=h+\tilde{\varepsilon}\\
Hh=h_0e_{1.T}+\sigma_vv\\
\tilde{\epsilon}\sim \log \chi^2_1\\
v\sim\mathcal{N}_T(0_T,I_T)\\

\end{align}\]</span>
<p>And approximate the <span class="math inline">\(\log \chi^2_1\)</span> distribution by a mixture of ten normal distributions given by:</p>
<span class="math display">\[\begin{align}

\log \chi^2_1\approx \sum_{m=1}^{10}Pr(s_t = m)\mathcal{N}(\mu_m,\sigma^2_m)

\end{align}\]</span>
<p>where:</p>
<ul>
<li><p>s_t ∈ {1, . . . , 10} is a discrete-valued random indicator of the mixture component</p></li>
<li><p><span class="math inline">\(\mu_m,\sigma^2_m\)</span> ,Pr(st = m) are predetermined</p></li>
</ul>
<p>Therefore, we could rewrite <span class="math inline">\(\tilde{\epsilon}\)</span> in a <strong>Normal distribution</strong>:</p>
<span class="math display">\[\begin{align}

\tilde{\epsilon}|s \sim\mathcal{N}(\mu_s,diag(\sigma^2_s))

\end{align}\]</span>
</section>
<section id="priors-distribution" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="priors-distribution"><span class="header-section-number">4.6.2</span> Priors distribution</h3>
<p>Hierarchical prior structure is given by:</p>
<span class="math display">\[\begin{align}

P(h,s,h_0,\sigma^2_v)=P(h|h_0,\sigma^2_v)P(h_0)P(\sigma^2_v)P(s)

\end{align}\]</span>
<p>Therefore, conditional prior distribution for <span class="math inline">\(h\)</span> is:</p>
<span class="math display">\[\begin{align}

P(h|h_0,\sigma^2_v)\sim\mathcal{N}(h_0H^{-1}e_{1.T},\sigma^2_v(H'H)^{-1})

\end{align}\]</span>
<p>with kernel given by:</p>
<span class="math display">\[\begin{align}

\propto det(\sigma^2_v\textbf{I}_T)^{-\frac{1}{2}}exp\left( -\frac{1}{2}\sigma^{-2}_v\left( Hh-h_0e_{1.T} \right)'\left( Hh-h_0e_{1.T} \right) \right)

\end{align}\]</span>
<p>Prior distribution for <span class="math inline">\(h_0\)</span> is:</p>
<span class="math display">\[\begin{align}

P(h_0)\sim\mathcal{N}(0,\underline{\sigma}^2_h)

\end{align}\]</span>
<p>with kernel given by:</p>
<span class="math display">\[\begin{align}

\propto \left( \underline{\sigma}^2_h \right)^{-\frac{1}{2}}exp\left( -\frac{1}{2}\underline{\sigma}^{-2}_hh_0h_0 \right)

\end{align}\]</span>
<p>Prior distribution for <span class="math inline">\(\sigma^2_v\)</span> is:</p>
<span class="math display">\[\begin{align}

P(\sigma^2_v)\sim\mathcal{IG2}(\underline{s},\underline{\nu})

\end{align}\]</span>
<p>with kernel given by:</p>
<span class="math display">\[\begin{align}

\propto \left( \underline{\sigma}^2_v \right)^{-\frac{\underline{\nu}+2}{2}}exp\left( -\frac{1}{2}\frac{\underline{s}}{\underline{\sigma}^{2}_v} \right)

\end{align}\]</span>
<p>Prior distribution for <span class="math inline">\(s\)</span> is:</p>
<span class="math display">\[\begin{align}

P(s_t)\sim\mathcal{Multinomial}(\mathrm{\left\{ m \right\}}_{m=1}^{10},\mathrm{\left\{Pr(s_t=m) \right\}}_{m=1}^{10})

\end{align}\]</span>
</section>
<section id="bayesian-estimations-2" class="level3" data-number="4.6.3">
<h3 data-number="4.6.3" class="anchored" data-anchor-id="bayesian-estimations-2"><span class="header-section-number">4.6.3</span> Bayesian Estimations</h3>
<p>For joint posteriors distribution, <span class="math inline">\(A\)</span>, <span class="math inline">\(\Sigma\)</span> can then be derived using the likelihood and the prior distributions as follows:</p>
<span class="math display">\[\begin{align}

P(A,\Sigma|Y,X,\Omega) &amp;\propto L(A,\Sigma,\Omega|Y,X) \ P(A,\Sigma) \\
\\
&amp;= \det(\Sigma)^{-\frac{T}{2}} \det(\Omega)^{-\frac{N}{2}} exp\{-\frac{1}{2} \textbf{tr}[\Sigma^{-1} (Y-XA)' \Omega^{-1} (Y-XA) ]\} \\
&amp;\times \det(\Sigma)^{-\frac{N+k+\underline{\nu}+1}{2}} exp\{-\frac{1}{2}\textbf{tr}[\Sigma^{-1}(A-\underline{A})'(\underline{V})^{-1}(A-\underline{A})]\} \\
&amp;\times exp\{-\frac{1}{2}\textbf{tr}[\Sigma^{-1}\underline{S}]\} \\

&amp;= \det(\Sigma)^{-\frac{T+N+K+\underline{\nu}+1}{2}} \det(\Omega)^{-\frac{N}{2}} \\
&amp;\times exp\{-\frac{1}{2} \textbf{tr}[\Sigma^{-1}(Y'\Omega^{-1}Y - 2A'X'\Omega^{-1}Y + A'X'\Omega^{-1}XA \\
&amp;+ A'\underline{V}^{-1}A -2A'\underline{V}^{-1}\underline{A} + \underline{A}'\underline{V}^{-1}\underline{A} + \underline{S})]\}

\end{align}\]</span>
<p>Then, we have same kernel presentation as <strong>Laplace Distribution</strong> and could be rearranged in the form of the <strong>Normal-inverse Wishart distribution</strong> and given by:</p>
<span class="math display">\[\begin{align}

P(A,\Sigma|Y,X,\Omega) &amp;\sim \mathcal{NIW}(\bar{A},\bar{V},\bar{S},\bar{\nu}) \\
&amp;\\
\bar{V} &amp;= (X'\Omega^{-1}X + \underline{V}^{-1})^{-1} \\
\bar{A} &amp;= \bar{V}(X'\Omega^{-1}Y + \underline{V}^{-1}\underline{A}) \\
\bar{\nu} &amp;= T + \underline{\nu}\\
\bar{S} &amp;= \underline{S} + Y'\Omega^{-1}Y + \underline{A}'\underline{V}^{-1}\underline{A} - \bar{A}'\bar{V}^{-1}\bar{A}

\end{align}\]</span>
<p>The kernel of the fully conditional posterior distribution of <span class="math inline">\(h\)</span> is then derived as follows:</p>
<span class="math display">\[\begin{align}

P(h|h_0,\sigma^2_v,s,\tilde{y}) &amp;\propto L(h,h_0,\sigma^2_v,s|\tilde{y})P(h) \\
&amp;\propto exp\left( -\frac{1}{2}\left( h-(\tilde{y}-\mu_s) \right)'diag\left(\sigma^2_s  \right)^{-1}\left( h-(\tilde{y}-\mu_s) \right) \right)\\
&amp;\times exp\left( -\frac{1}{2}\sigma^{-2}_v\left( Hh-h_0e_{1.T} \right)'\left( Hh-h_0e_{1.T} \right) \right)\\

\end{align}\]</span>
<p>The above expression can be rearranged in the form of a Normal distribution kernel as follows:</p>
<span class="math display">\[\begin{align}

P(h|h_0,\sigma^2_v,s,\tilde{y}) &amp;\sim \mathcal{N}(\overline{h},\overline{V}_h)\\
\overline{V}_h&amp;=\left[ diag\left(\sigma^2_s \right)^{-1}+ \sigma^{-2}_vH'H\right]^{-1}\\
\overline{h}&amp;=\overline{V}_h\left[ diag\left(\sigma^2_s \right)^{-1}(\tilde{y}-\mu_s)+ \sigma^{-2}_vh_0e_{1.T}\right]\\

\end{align}\]</span>
<p>The kernel of the fully conditional posterior distribution of <span class="math inline">\(h_0\)</span> is then derived as follows:</p>
<span class="math display">\[\begin{align}

P(h_0|h,\sigma^2_v,s,\tilde{y}) &amp;\propto L(h_0,\sigma^2_v|h)P(h_0) \\
&amp;\propto exp\left( -\frac{1}{2}\sigma^{-2}_v\left( Hh-h_0e_{1.T} \right)'\left( Hh-h_0e_{1.T} \right) \right)\\
&amp;\times exp\left( -\frac{1}{2}\underline{\sigma}^{-2}_hh_0h_0 \right)

\end{align}\]</span>
<p>The above expression can be rearranged in the form of a Normal distribution kernel as follows:</p>
<span class="math display">\[\begin{align}

P(h_0|h,\sigma^2_v,s,\tilde{y}) &amp;\sim \mathcal{N}(\overline{h}_0,\overline{\sigma}^2_h)\\
\overline{\sigma}^2_h&amp;=\left(\underline{\sigma}^{-2}_h+ \sigma^{-2}_v\right)^{-1}\\
\overline{h}_0&amp;=\overline{\sigma}^2_h\left(\sigma^{-2}_ve_{1.T}'Hh\right)^{-1}\\

\end{align}\]</span>
<p>The kernel of the fully conditional posterior distribution of <span class="math inline">\(\sigma^2_v\)</span> is then derived as follows:</p>
<span class="math display">\[\begin{align}

P(\sigma^2_v|h,h_0,s,\tilde{y}) &amp;\propto L(h_0,\sigma^2_v|h)P(\sigma^2_v) \\
&amp;\propto exp\left( -\frac{1}{2}\sigma^{-2}_v\left( Hh-h_0e_{1.T} \right)'\left( Hh-h_0e_{1.T} \right) \right)\\
&amp;\times \left( \underline{\sigma}^2_v \right)^{-\frac{\underline{\nu}+2}{2}}exp\left( -\frac{1}{2}\frac{\underline{s}}{\underline{\sigma}^{2}_v} \right)

\end{align}\]</span>
<p>The above expression can be rearranged in the form of a Inverse-Gamma 2 distribution kernel as follows:</p>
<span class="math display">\[\begin{align}

P(\sigma^2_v|h,h_0,s,\tilde{y}) &amp;\sim \mathcal{IG2}(\overline{s},\overline{\nu})\\
\overline{\nu}&amp;=\underline{\nu}+ T\\
\overline{s}&amp;=\underline{s}+\left( Hh-h_0e_{1.T} \right)'\left( Hh-h_0e_{1.T} \right)\\

\end{align}\]</span>
<p>The fully conditional posterior distribution of <span class="math inline">\(s\)</span> is a multinomial distribution with the probabilities proportional to:</p>
<span class="math display">\[\begin{align}

\omega_{m.t} = Pr[s_t=m]p(\tilde{y}|h_t,s_t=m),\text{for} \ m=1,...,10

\end{align}\]</span>
<p>For each <span class="math inline">\(t\)</span> and <span class="math inline">\(m\)</span> obtain <span class="math inline">\(\omega_{m.t}\)</span> using parallel computations and compute the probabilities of the multinomial full conditional posterior distribution by:</p>
<span class="math display">\[\begin{align}

Pr[s_t=m|\tilde{y},h_t]=\frac{\omega_{m.t}}{\sum_{i=1}^{10}\omega_{m.t}}

\end{align}\]</span>
</section>
<section id="gibbs-sampler" class="level3" data-number="4.6.4">
<h3 data-number="4.6.4" class="anchored" data-anchor-id="gibbs-sampler"><span class="header-section-number">4.6.4</span> Gibbs Sampler</h3>
<p>Considering draws from this posterior involves a Gibbs sampler, which follows the following algorithm:</p>
<ol type="1">
<li><p>Initialize <span class="math inline">\(h^{(0)}\)</span>, <span class="math inline">\(s^{(0)}\)</span>, and <span class="math inline">\(\sigma^{2(0)}_v\)</span></p></li>
<li><p>Draw <span class="math inline">\(h_0^{(s)}\sim\mathcal{N}(\bar{h}_0,\bar{\sigma}^2_h)\)</span></p></li>
<li><p>Draw <span class="math inline">\(\sigma_v^{2(s)}\sim\mathcal{IG2}(\bar{s},\bar{\nu})\)</span></p></li>
<li><p>Draw <span class="math inline">\(s_t^{(s)}\sim\mathcal{Multiomial}(\{m\}^{10}_{m=1},\{Pr[s_t=m|\tilde{y},h_t^{(s)}]\}^{10}_{m=1})\)</span> for all <span class="math inline">\(s_t\)</span> in <span class="math inline">\(s\)</span>.</p></li>
<li><p>Draw <span class="math inline">\(h^{(s)}\sim\mathcal{N}_T(\bar{h},\bar{V}_h)\)</span></p></li>
<li><p>Draw <span class="math inline">\((A,\Sigma)\sim\mathcal{MNIW}(\bar{A},\bar{V},\bar{S},\bar{\nu})\)</span></p></li>
</ol>
<p>Steps 2 to 7 are repeated for <span class="math inline">\(S=S_1+S_2\)</span> draws, where <span class="math inline">\(S_1\)</span> draws are discarded as burn-in and the latter <span class="math inline">\(S_2\)</span> draws are kept as posterior draws.</p>
<p>First Hierarchical draws based on following function <code>SVcommon.Gibbs.iteration</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>SVcommon.Gibbs.iteration <span class="ot">&lt;-</span> <span class="cf">function</span>(aux, priors){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># A single iteration of the Gibbs sampler for the SV component</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aux is a list containing:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   Y         - a TxN matrix</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   X         - a TxK matrix</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   H         - a Tx1 matrix                 </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   h0        - a scalar</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   sigma.v2  - a scalar</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   s         - a Tx1 matrix</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   A         - a KxN matrix</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   Sigma     - an NxN matrix</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   sigma2    - a Tx1 matrix</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># priors is a list containing:</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   h0.v      - a positive scalar</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   h0.m      - a scalar</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   sigmav.s  - a positive scalar</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   sigmav.nu - a positive scalar</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   HH        - a TxT matrix</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  T             <span class="ot">=</span> <span class="fu">dim</span>(aux<span class="sc">$</span>Y)[<span class="dv">1</span>]</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  N             <span class="ot">=</span> <span class="fu">dim</span>(aux<span class="sc">$</span>Y)[<span class="dv">2</span>]</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  alpha.st      <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.92677</span>,<span class="fl">1.34744</span>,<span class="fl">0.73504</span>,<span class="fl">0.02266</span>,<span class="dv">0</span><span class="fl">-0.85173</span>,<span class="sc">-</span><span class="fl">1.97278</span>,<span class="sc">-</span><span class="fl">3.46788</span>,<span class="sc">-</span><span class="fl">5.55246</span>,<span class="sc">-</span><span class="fl">8.68384</span>,<span class="sc">-</span><span class="fl">14.65000</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  sigma.st      <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.11265</span>,<span class="fl">0.17788</span>,<span class="fl">0.26768</span>,<span class="fl">0.40611</span>,<span class="fl">0.62699</span>,<span class="fl">0.98583</span>,<span class="fl">1.57469</span>,<span class="fl">2.54498</span>,<span class="fl">4.16591</span>,<span class="fl">7.33342</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  pi.st         <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.00609</span>,<span class="fl">0.04775</span>,<span class="fl">0.13057</span>,<span class="fl">0.20674</span>,<span class="fl">0.22715</span>,<span class="fl">0.18842</span>,<span class="fl">0.12047</span>,<span class="fl">0.05591</span>,<span class="fl">0.01575</span>,<span class="fl">0.00115</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  Lambda        <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">chol</span>(aux<span class="sc">$</span>Sigma))</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  Z             <span class="ot">=</span> <span class="fu">rowSums</span>( ( aux<span class="sc">$</span>Y <span class="sc">-</span> aux<span class="sc">$</span>X <span class="sc">%*%</span> aux<span class="sc">$</span>A ) <span class="sc">%*%</span> Lambda ) <span class="sc">/</span> <span class="fu">sqrt</span>(N)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  Y.tilde       <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">log</span>((Z <span class="sc">+</span> <span class="fl">0.0000001</span>)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  Ytilde.alpha  <span class="ot">=</span> <span class="fu">as.matrix</span>(Y.tilde <span class="sc">-</span> alpha.st[<span class="fu">as.vector</span>(aux<span class="sc">$</span>s)])</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sampling initial condition</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  V.h0.bar      <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span> <span class="sc">/</span> priors<span class="sc">$</span>h0.v) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">/</span> aux<span class="sc">$</span>sigma.v2))</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  m.h0.bar      <span class="ot">=</span> V.h0.bar<span class="sc">*</span>((priors<span class="sc">$</span>h0.m <span class="sc">/</span> priors<span class="sc">$</span>h0.v) <span class="sc">+</span> (aux<span class="sc">$</span>H[<span class="dv">1</span>] <span class="sc">/</span> aux<span class="sc">$</span>sigma.v2))</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  h0.draw       <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> m.h0.bar, <span class="at">sd =</span> <span class="fu">sqrt</span>(V.h0.bar))</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  aux<span class="sc">$</span>h0        <span class="ot">=</span> h0.draw    </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sampling sigma.v2</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  sigma.v2.s    <span class="ot">=</span> priors<span class="sc">$</span>sigmav.s <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">c</span>(aux<span class="sc">$</span>H[<span class="dv">1</span>] <span class="sc">-</span> aux<span class="sc">$</span>h0, <span class="fu">diff</span>(aux<span class="sc">$</span>H))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  sigma.v2.draw <span class="ot">=</span> sigma.v2.s <span class="sc">/</span> <span class="fu">rchisq</span>(<span class="dv">1</span>, priors<span class="sc">$</span>sigmav.nu <span class="sc">+</span> T)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  aux<span class="sc">$</span>sigma.v2  <span class="ot">=</span> sigma.v2.draw    </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sampling auxiliary states</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  Pr.tmp        <span class="ot">=</span> <span class="fu">simplify2array</span>(<span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="cf">function</span>(x){</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dnorm</span>(Y.tilde, <span class="at">mean =</span> <span class="fu">as.vector</span>(aux<span class="sc">$</span>H <span class="sc">+</span> alpha.st[x]), <span class="at">sd =</span> <span class="fu">sqrt</span>(sigma.st[x]), <span class="at">log =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">log</span>(pi.st[x])</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  Pr            <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">apply</span>(Pr.tmp, <span class="dv">1</span>, <span class="cf">function</span>(x){<span class="fu">exp</span>(x <span class="sc">-</span> <span class="fu">max</span>(x)) <span class="sc">/</span> <span class="fu">sum</span>(<span class="fu">exp</span>(x <span class="sc">-</span> <span class="fu">max</span>(x)))}))</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  s.cum         <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">apply</span>(Pr, <span class="dv">1</span>, cumsum))</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  r             <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fu">runif</span>(T), <span class="dv">10</span>), <span class="at">ncol =</span> <span class="dv">10</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  ss            <span class="ot">=</span> <span class="fu">apply</span>(s.cum <span class="sc">&lt;</span> r, <span class="dv">1</span>, sum) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  aux<span class="sc">$</span>s         <span class="ot">=</span> <span class="fu">as.matrix</span>(ss)       </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sampling log-volatilities using functions for tridiagonal precision matrix</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  Sigma.s.inv   <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span> <span class="sc">/</span> sigma.st[<span class="fu">as.vector</span>(aux<span class="sc">$</span>s)])</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  D.inv         <span class="ot">=</span> Sigma.s.inv <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">/</span> aux<span class="sc">$</span>sigma.v2) <span class="sc">*</span> priors<span class="sc">$</span>HH</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  b             <span class="ot">=</span> <span class="fu">as.matrix</span>(Ytilde.alpha <span class="sc">/</span> sigma.st[<span class="fu">as.vector</span>(aux<span class="sc">$</span>s)] <span class="sc">+</span> (aux<span class="sc">$</span>h0<span class="sc">/</span>aux<span class="sc">$</span>sigma.v2)<span class="sc">*</span><span class="fu">diag</span>(T)[,<span class="dv">1</span>])</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  lead.diag     <span class="ot">=</span> <span class="fu">diag</span>(D.inv)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  sub.diag      <span class="ot">=</span> mgcv<span class="sc">::</span><span class="fu">sdiag</span>(D.inv, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  D.chol        <span class="ot">=</span> mgcv<span class="sc">::</span><span class="fu">trichol</span>(<span class="at">ld =</span> lead.diag, <span class="at">sd =</span> sub.diag)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>  D.L           <span class="ot">=</span> <span class="fu">diag</span>(D.chol<span class="sc">$</span>ld)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  mgcv<span class="sc">::</span><span class="fu">sdiag</span>(D.L,<span class="sc">-</span><span class="dv">1</span>) <span class="ot">=</span> D.chol<span class="sc">$</span>sd</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>  x             <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">rnorm</span>(T))</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>  a             <span class="ot">=</span> <span class="fu">forwardsolve</span>(D.L, b)</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>  draw          <span class="ot">=</span> <span class="fu">backsolve</span>(<span class="fu">t</span>(D.L), a <span class="sc">+</span> x)</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>  aux<span class="sc">$</span>H         <span class="ot">=</span> <span class="fu">as.matrix</span>(draw)         </span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>  aux<span class="sc">$</span>sigma2    <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">exp</span>(draw))     </span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(aux)</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Therefore, we could have the function <code>DrawPosterior.sv</code> to draw <span class="math inline">\(A\)</span> and <span class="math inline">\(\Sigma\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>DrawPosterior.sv <span class="ot">&lt;-</span> <span class="cf">function</span> (Y,X,S1,S2){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">ncol</span>(Y)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  T <span class="ot">&lt;-</span> <span class="fu">nrow</span>(Y)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  A.posterior     <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>,<span class="fu">c</span>(K,N,(S1<span class="sc">+</span>S2)))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  Sigma.posterior <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>,<span class="fu">c</span>(N,N,(S1<span class="sc">+</span>S2))) </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  H.posterior     <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>,<span class="fu">c</span>(<span class="fu">nrow</span>(Y),(S1<span class="sc">+</span>S2<span class="sc">+</span><span class="dv">1</span>)))  </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  B.posterior     <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>,<span class="fu">c</span>(N,N,(S1<span class="sc">+</span>S2)))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  B1.tilde.s      <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>,<span class="fu">c</span>(N,K,(S1<span class="sc">+</span>S2)))</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize h^{0}, which is  T by 1 matrix </span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  H.posterior[,<span class="dv">1</span>]       <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>,T,<span class="dv">1</span>) </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  nu.bar                <span class="ot">&lt;-</span> <span class="fu">nrow</span>(Y) <span class="sc">+</span> nu.prior</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  HH                    <span class="ot">&lt;-</span>  <span class="dv">2</span><span class="sc">*</span><span class="fu">diag</span>(T)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  mgcv<span class="sc">::</span><span class="fu">sdiag</span>(HH,<span class="sc">-</span><span class="dv">1</span>)    <span class="ot">&lt;-</span>  <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  mgcv<span class="sc">::</span><span class="fu">sdiag</span>(HH,<span class="dv">1</span>)     <span class="ot">&lt;-</span>  <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  priors <span class="ot">=</span> <span class="fu">list</span>(<span class="at">HH       =</span> HH,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">h0.m     =</span> <span class="dv">0</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">h0.v     =</span> <span class="dv">1</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">sigmav.s =</span> <span class="dv">1</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">sigmav.nu=</span> <span class="dv">1</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(S1<span class="sc">+</span>S2)){</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># STEP 1: draw (A Sigma).s from MNIW(A.bar,V.bar,S.bar,nu.bar)</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># setting up parameters </span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    V.bar.inv       <span class="ot">&lt;-</span> <span class="fu">t</span>(X)<span class="sc">%*%</span><span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span>H.posterior[,s])<span class="sc">%*%</span>X <span class="sc">+</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">diag</span>(V.prior))</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    V.bar           <span class="ot">&lt;-</span> <span class="fu">solve</span>(V.bar.inv)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    A.bar           <span class="ot">&lt;-</span> V.bar<span class="sc">%*%</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span><span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span>H.posterior[,s])<span class="sc">%*%</span>Y <span class="sc">+</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">diag</span>(V.prior))<span class="sc">%*%</span>A.prior)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    S.bar           <span class="ot">&lt;-</span> S.prior<span class="sc">+</span><span class="fu">t</span>(Y)<span class="sc">%*%</span><span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span>H.posterior[,s])<span class="sc">%*%</span>Y<span class="sc">+</span><span class="fu">t</span>(A.prior)<span class="sc">%*%</span><span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">diag</span>(V.prior))<span class="sc">%*%</span>A.prior <span class="sc">-</span> <span class="fu">t</span>(A.bar)<span class="sc">%*%</span>V.bar.inv<span class="sc">%*%</span>A.bar</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    draw.sigma.inv  <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">rWishart</span>(<span class="dv">1</span>, <span class="at">df=</span>nu.bar, <span class="at">Sigma=</span><span class="fu">solve</span>(S.bar))[,,<span class="dv">1</span>])</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    Sigma.posterior[,,s] <span class="ot">=</span> draw.sigma.inv</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>      <span class="co"># start drawing </span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    cholSigma.s      <span class="ot">&lt;-</span> <span class="fu">chol</span>(Sigma.posterior[,,s])</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    A.posterior[,,s] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="dv">1</span>,<span class="fu">as.vector</span>(A.bar),Sigma.posterior[,,s]<span class="sc">%x%</span>V.bar),<span class="at">ncol=</span>N)      </span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># STEP 2: draw H from SVcommon.Gibbs.iteration</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (s <span class="sc">==</span> <span class="dv">1</span>){ <span class="co"># initializing input arguments </span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>        aux <span class="ot">=</span> <span class="fu">list</span>( </span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>              <span class="at">Y             =</span> Y,</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>              <span class="at">X             =</span> X,</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>              <span class="at">H             =</span> <span class="fu">matrix</span>(<span class="dv">1</span>,T,<span class="dv">1</span>),</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>              <span class="at">h0            =</span> <span class="dv">0</span>,</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>              <span class="at">sigma.v2      =</span> <span class="dv">1</span>,</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>              <span class="at">s             =</span> <span class="fu">matrix</span>(<span class="dv">1</span>,T,<span class="dv">1</span>),</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>              <span class="at">Sigma         =</span> Sigma.posterior[,,s],</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>              <span class="at">A             =</span> A.posterior[,,s],</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>              <span class="at">sigma2        =</span> <span class="fu">matrix</span>(<span class="dv">1</span>,T,<span class="dv">1</span>)</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{ <span class="co"># updating input arguments  </span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>      aux <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>                <span class="at">Y           =</span> Y,</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>                <span class="at">X           =</span> X,</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>                <span class="at">H           =</span> tmp<span class="sc">$</span>H,</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>                <span class="at">h0          =</span> tmp<span class="sc">$</span>h0,</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>                <span class="at">sigma.v2    =</span> tmp<span class="sc">$</span>sigma.v2,</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>                <span class="at">s           =</span> tmp<span class="sc">$</span>s,</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>                <span class="at">Sigma       =</span> Sigma.posterior[,,s],</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>                <span class="at">A           =</span> A.posterior[,,s],</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>                <span class="at">sigma2      =</span> tmp<span class="sc">$</span>sigma2</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># H                     &lt;- diag(T)</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sdiag(H,-1)           &lt;- -1     </span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    tmp                     <span class="ot">&lt;-</span> <span class="fu">SVcommon.Gibbs.iteration</span>(aux,priors)</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    H.posterior[,s<span class="sc">+</span><span class="dv">1</span>]      <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp<span class="sc">$</span>sigma2)</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Sigma.posterior =</span> Sigma.posterior[,,(S1<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(S1<span class="sc">+</span>S2)],</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>              <span class="at">A.posterior     =</span> A.posterior[,,(S1<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(S1<span class="sc">+</span>S2)],</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>              <span class="at">H.sv            =</span> H.posterior[,(S1<span class="sc">+</span><span class="dv">2</span>)<span class="sc">:</span>(S1<span class="sc">+</span>S2<span class="sc">+</span><span class="dv">1</span>)]))</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below posterior mean provides a time series plot of posterior draws mean of <span class="math inline">\(\sigma^2\)</span> at each time spot. From where we can observe the <span class="math inline">\(\sigma^2\)</span> oscillating around 2100.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Following plots the draws of Gibbs Sampler of the Stochastic Volatility model, and it shown to be stationary for A and <span class="math inline">\(\Sigma\)</span>.From where, we can observe the mean of <span class="math inline">\(A_{21},A_{32}\)</span> varying around value of 1, <span class="math inline">\(\Sigma_{21},\Sigma_{22}\)</span> oscillating around 0.0018-0.0020.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-Gibbs-Sampler-SV" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-Gibbs-Sampler-SV-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Gibbs Sampler draws of A and Sigma-SV model</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="combinations-of-extension" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="combinations-of-extension"><span class="header-section-number">4.7</span> Combinations of Extension</h2>
<p>Due to complications in the real world, some of common shocks to the market are deep influenced and some are disappeared in a decided time period. For example, the GFC, Covid-19 and Russian-Ukraine war influence for a long time, even right now, we are underlying a quantitative easing scenario and suffering a common inflation risk. That reflects that the effects to serial covariance some are independently and some part are autoregressive on the other hand. Therefore, we could combine the Laplace model and Stochastic Volatility model to present, estimate and forecast under this complicated scenario.</p>
<p>Therefore, we could have the model present as:</p>
<span class="math display">\[\begin{align}

Y &amp;= X A +U
\\
\\
U|X &amp;\sim \mathcal{MN}_{T\times N}(\textbf{0},\Sigma,\Omega)\\
vec(U) \ &amp;\sim N(0 \ , \ \Sigma \ \otimes \  \Omega)\\
\Omega \ &amp;= diag\left[\lambda_{1} \sigma^2_1, \lambda_{2}\sigma^2_2..., \lambda_{t}\sigma^2_T\right]\\
&amp;=\ diag\left[ \lambda_{1}exp\left\{ h_1 \right\},\lambda_{2}exp\left\{ h_2 \right\},...,\lambda_{T}exp\left\{ h_T \right\}  \right]\\
\lambda \ &amp;\sim \ Exp \ (\alpha)\\
h_t &amp;= h_{t-1}+\sigma_{v}v_t\\
v_t&amp;\sim N(0,1)\\

\end{align}\]</span>
<p>Still have that:</p>
<span class="math display">\[\begin{align}

\epsilon_t &amp;\sim N(0,1)\\

\end{align}\]</span>
<p>Now we could rewrite the equation into:</p>
<span class="math display">\[\begin{align}

y_t &amp;= y_{t-1}A_1 \ \ + ...+y_{t-p}A_p+\ \ \sqrt{\lambda_t}exp\left\{ \frac{1}{2} h_t\right\}\epsilon_t\\
\frac{y_t - y_{t-1}A_1 \ \ + ...+y_{t-p}A_p}{\sqrt{\lambda_t}} &amp;= exp\left\{ \frac{1}{2} h_t\right\}\epsilon_t\\
y_{\lambda.t}&amp;=exp\left\{ \frac{1}{2} h_t\right\}\epsilon_t\\
\\
y_{\lambda.t}&amp;=exp\left\{ \frac{1}{2} h_t\right\}\epsilon_t\\
log \ y_{\lambda.t}^2&amp;=h_t + log \ \epsilon_t^2\\
\tilde{y}_{\lambda.t}&amp;=h_t+\tilde{\epsilon}_t

\end{align}\]</span>
<p>Same to the standard Stochastic Volatility model, and the Hierarchical prior structure are same:</p>
<span class="math display">\[\begin{align}

\tilde{y}_{\lambda}=h+\tilde{\varepsilon}\\
Hh=h_0e_{1.T}+\sigma_vv\\
\tilde{\epsilon}\sim \log \chi^2_1\\
v\sim\mathcal{N}_T(0_T,I_T)\\

P(h,s,h_0,\sigma^2_v)=P(h|h_0,\sigma^2_v)P(h_0)P(\sigma^2_v)P(s)

\end{align}\]</span>
<section id="likelihood-function-1" class="level3" data-number="4.7.1">
<h3 data-number="4.7.1" class="anchored" data-anchor-id="likelihood-function-1"><span class="header-section-number">4.7.1</span> Likelihood Function</h3>
<p>The general likelihood function remain unchanged due to continues of serial covariance symbol <span class="math inline">\(\Omega\)</span> is used:</p>
<span class="math display">\[\begin{align}

L(A,\Sigma,\Omega |Y,X) &amp;\propto \det(\Sigma)^{-\frac{T}{2}} \det(\Omega)^{-\frac{N}{2}} exp\{-\frac{1}{2}\textbf{tr}[\Sigma^{-1} (Y-XA)' \Omega^{-1} (Y-XA) ]\}\\

\end{align}\]</span>
<p>After simplify we could have:</p>
<span class="math display">\[\begin{align}

L(A,\Sigma,\Omega |Y,X) &amp;\propto \det(\Sigma)^{-\frac{T}{2}} \det(\Omega)^{-\frac{N}{2}} exp\{-\frac{1}{2}\textbf{tr}[\Sigma^{-1} (Y-XA)' \Omega^{-1} (Y-XA) ]\}\\
&amp;=\det(\Sigma)^{-\frac{T}{2}}\left( \prod^{T}_{t = 1} \lambda_t\prod^{T}_{t = 1} exp\left\{ h_t \right\} \right)^{-\frac{N}{2}} exp\left\{{-\frac{1}{2}}\sum^{T}_{t =1}\lambda_texp\left\{ h_t \right\}^{-1} \textbf{tr}[\epsilon_t' \Sigma^{-1}\epsilon_t)]\right\}\\
&amp;=\det(\Sigma)^{-\frac{T}{2}}\prod^{T}_{t = 1} \lambda_t^{-\frac{N}{2}} exp\left\{{-\frac{N}{2}}\sum^{T}_{t =1}h_t{-\frac{1}{2}}\sum^{T}_{t =1}\lambda_texp\left\{ h_t \right\}^{-1} \textbf{tr}[\epsilon_t' \Sigma^{-1}\epsilon_t)]\right\}\\

\end{align}\]</span>
</section>
<section id="bayesian-estimations-3" class="level3" data-number="4.7.2">
<h3 data-number="4.7.2" class="anchored" data-anchor-id="bayesian-estimations-3"><span class="header-section-number">4.7.2</span> Bayesian Estimations</h3>
<p>As the unchanged likelihood function, we still have:</p>
<span class="math display">\[\begin{align}

P(A,\Sigma|Y,X,\Omega) &amp;\propto L(A,\Sigma,\Omega|Y,X) \ P(A,\Sigma) \\
\\
&amp;= \det(\Sigma)^{-\frac{T}{2}} \det(\Omega)^{-\frac{N}{2}} exp\{-\frac{1}{2} \textbf{tr}[\Sigma^{-1} (Y-XA)' \Omega^{-1} (Y-XA) ]\} \\
&amp;\times \det(\Sigma)^{-\frac{N+k+\underline{\nu}+1}{2}} exp\{-\frac{1}{2}\textbf{tr}[\Sigma^{-1}(A-\underline{A})'(\underline{V})^{-1}(A-\underline{A})]\} \\
&amp;\times exp\{-\frac{1}{2}\textbf{tr}[\Sigma^{-1}\underline{S}]\} \\

&amp;= \det(\Sigma)^{-\frac{T+N+K+\underline{\nu}+1}{2}} \det(\Omega)^{-\frac{N}{2}} \\
&amp;\times exp\{-\frac{1}{2} \textbf{tr}[\Sigma^{-1}(Y'\Omega^{-1}Y - 2A'X'\Omega^{-1}Y + A'X'\Omega^{-1}XA \\
&amp;+ A'\underline{V}^{-1}A -2A'\underline{V}^{-1}\underline{A} + \underline{A}'\underline{V}^{-1}\underline{A} + \underline{S})]\}

\end{align}\]</span>
<p>Which is the kernel represent as <strong>Normal-inverse Wishart distribution</strong> and given by:</p>
<span class="math display">\[\begin{align}

P(A,\Sigma|Y,X,\Omega) &amp;\sim \mathcal{NIW}(\bar{A},\bar{V},\bar{S},\bar{\nu}) \\
&amp;\\
\bar{V} &amp;= (X'\Omega^{-1}X + \underline{V}^{-1})^{-1} \\
\bar{A} &amp;= \bar{V}(X'\Omega^{-1}Y + \underline{V}^{-1}\underline{A}) \\
\bar{\nu} &amp;= T + \underline{\nu}\\
\bar{S} &amp;= \underline{S} + Y'\Omega^{-1}Y + \underline{A}'\underline{V}^{-1}\underline{A} - \bar{A}'\bar{V}^{-1}\bar{A}

\end{align}\]</span>
<p>The posterior of <span class="math inline">\(\lambda_t\)</span> could be precent in the form of <span class="math inline">\(\sigma^2\)</span> which is:</p>
<span class="math display">\[\begin{align}

P(\lambda_t|Y,X,A,\Sigma,h,h_0,\sigma^2_v) &amp;\propto L(A,\Sigma,\lambda_t,h,h_0,\sigma^2_v|Y,X)P(\lambda_t) \\
\\
&amp;\propto \lambda_t^{-\frac{N}{2}}exp({-\frac{1}{2}}{\frac{1}{\lambda_t}}\textbf{tr}[\Sigma^{-1}\epsilon_t' diag(\sigma^2)\epsilon_t]) \\
&amp;\times \frac{1}{\alpha}exp\{ -\frac{1}{\alpha}\lambda_t \}\\
&amp;\propto \lambda_t^{-\frac{N}{2}+1-1} exp\{-\frac{1}{2}[\frac{\textbf{tr}[\Sigma^{-1}
\epsilon_t'diag(\sigma^2)\epsilon_t]} {\lambda_t} +\frac{2}{\alpha}\lambda_t]\}

\end{align}\]</span>
<p>The above expression can be rearranged in the form of a Generalized inverse Gaussian distribution kernel as follows:</p>
<span class="math display">\[\begin{align}

\lambda_t|Y,A,\Sigma &amp;\sim \mathcal{GIG}(a,b,p) \\
\\
a &amp;=\frac{2}{\alpha} \\
b &amp;= \textbf{tr}[\Sigma^{-1}\epsilon_t'diag(\sigma^2)\epsilon_t] \\
p &amp;= -\frac{N}{2}+1

\end{align}\]</span>
<p>The posterior for Hierarchical structure <span class="math inline">\(h,h_0,s,\sigma^2_v\)</span> remain unchanged:</p>
<span class="math display">\[\begin{align}

P(h|h_0,\sigma^2_v,s,\tilde{y}) &amp;\sim \mathcal{N}(\overline{h},\overline{V}_h)\\
\overline{V}_h&amp;=\left[ diag\left(\sigma^2_s \right)^{-1}+ \sigma^{-2}_vH'H\right]^{-1}\\
\overline{h}&amp;=\overline{V}_h\left[ diag\left(\sigma^2_s \right)^{-1}(\tilde{y}-\mu_s)+ \sigma^{-2}_vh_0e_{1.T}\right]\\
\\
P(h_0|h,\sigma^2_v,s,\tilde{y}) &amp;\sim \mathcal{N}(\overline{h}_0,\overline{\sigma}^2_h)\\
\overline{\sigma}^2_h&amp;=\left(\underline{\sigma}^{-2}_h+ \sigma^{-2}_v\right)^{-1}\\
\overline{h}_0&amp;=\overline{\sigma}^2_h\left(\sigma^{-2}_ve_{1.T}'Hh\right)^{-1}\\
\\
P(\sigma^2_v|h,h_0,s,\tilde{y}) &amp;\sim \mathcal{IG2}(\overline{s},\overline{\nu})\\
\overline{\nu}&amp;=\underline{\nu}+ T\\
\overline{s}&amp;=\underline{s}+\left( Hh-h_0e_{1.T} \right)'\left( Hh-h_0e_{1.T} \right)\\
\\
Pr[s_t=m|\tilde{y},h_t]&amp;=\frac{\omega_{m.t}}{\sum_{i=1}^{10}\omega_{m.t}}

\end{align}\]</span>
</section>
<section id="gibbs-sampler-1" class="level3" data-number="4.7.3">
<h3 data-number="4.7.3" class="anchored" data-anchor-id="gibbs-sampler-1"><span class="header-section-number">4.7.3</span> Gibbs Sampler</h3>
<p>Given the hyper-parameters <span class="math inline">\(h_0,s,\sigma^{2}_v\)</span>, we could use same Hierarchical draws based on function <code>SVcommon.Gibbs.iteration</code> and then follow 3 steps:</p>
<ol type="1">
<li><p>Draw <span class="math inline">\((h^{(s)}, s^{(s)}, \sigma^{2(s)}_v,h^{(s)}\)</span></p></li>
<li><p>Draw <span class="math inline">\(\lambda^{(s)}\)</span></p></li>
<li><p>Draw <span class="math inline">\((A,\Sigma)\sim\mathcal{MNIW}(\bar{A},\bar{V},\bar{S},\bar{\nu})\)</span></p></li>
</ol>
<p>Therefore, we could have the function <code>posterior.draws.exten.hetero</code> to draw <span class="math inline">\(A\)</span> and <span class="math inline">\(\Sigma\)</span>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>posterior.draws.exten.hetero <span class="ot">=</span> <span class="cf">function</span> (total_S, Y, X){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Pre-setup </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  N             <span class="ot">=</span> <span class="fu">ncol</span>(Y) </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  t             <span class="ot">=</span> N <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  p             <span class="ot">=</span> <span class="fu">frequency</span>(Y)                      </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  A.hat         <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">%*%</span><span class="fu">t</span>(X)<span class="sc">%*%</span>Y</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  Sigma.hat     <span class="ot">=</span> <span class="fu">t</span>(Y<span class="sc">-</span>X<span class="sc">%*%</span>A.hat)<span class="sc">%*%</span>(Y<span class="sc">-</span>X<span class="sc">%*%</span>A.hat)<span class="sc">/</span><span class="fu">nrow</span>(Y)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  T             <span class="ot">=</span> <span class="fu">dim</span>(Y)[<span class="dv">1</span>] </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  K             <span class="ot">=</span> <span class="fu">dim</span>(X)[<span class="dv">2</span>] </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  H             <span class="ot">=</span> <span class="fu">diag</span>(T)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sdiag</span>(H,<span class="sc">-</span><span class="dv">1</span>)   <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  HH            <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">diag</span>(T)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sdiag</span>(HH,<span class="sc">-</span><span class="dv">1</span>)  <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sdiag</span>(HH,<span class="dv">1</span>)   <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prior distribution (with Minnesota prior)</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  A.prior           <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(A.hat),<span class="fu">ncol</span>(A.hat))</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  A.prior[<span class="dv">2</span><span class="sc">:</span>t,]     <span class="ot">=</span> <span class="fu">diag</span>(N)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  V.prior           <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa<span class="fl">.2</span>,kappa<span class="fl">.1</span><span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  S.prior           <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">diag</span>(Sigma.hat))</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  nu.prior          <span class="ot">=</span> N <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  lambda.priors     <span class="ot">=</span> <span class="fu">list</span>(<span class="at">alpha=</span><span class="dv">2</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  HH                <span class="ot">=</span> HH</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  h0.m              <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  h0.v              <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  sigmav.s          <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  sigmav.nu         <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define posterior</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  posteriors    <span class="ot">=</span> <span class="fu">list</span>(                        </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">H           =</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, T, total_S),</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma2      =</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, T, total_S),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">s           =</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, T, total_S),</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">h0          =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, total_S),</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma.v2    =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, total_S),</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">A           =</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>((<span class="dv">1</span> <span class="sc">+</span> N <span class="sc">*</span> p), N, total_S)),</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sigma       =</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>(N, N, total_S)),</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">lambda      =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, total_S)  </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define auxiliary</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  aux        <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y        =</span> Y,</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">X        =</span> X,</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">H        =</span> <span class="fu">matrix</span>(<span class="dv">1</span>, T, <span class="dv">1</span>),</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">h0       =</span> <span class="dv">0</span>,</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma.v2 =</span> <span class="dv">1</span>,</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">s        =</span> <span class="fu">matrix</span>(<span class="dv">1</span>, T, <span class="dv">1</span>),</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">A        =</span> <span class="fu">matrix</span>(<span class="dv">0</span>, K, N),</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sigma    =</span> <span class="fu">matrix</span>(<span class="dv">0</span>, N, N),             </span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma2   =</span> <span class="fu">matrix</span>(<span class="dv">1</span>, T, <span class="dv">1</span>),</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">lambda   =</span> <span class="dv">2</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>   <span class="co"># ----------------------posterior.draws.exten.hetero------------------------------</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_S){ </span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normal-inverse Wishard posterior </span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>      V.bar.inv              <span class="ot">=</span> <span class="fu">t</span>(aux<span class="sc">$</span>X)<span class="sc">%*%</span>(aux<span class="sc">$</span>lambda<span class="sc">*</span><span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">as.vector</span>(aux<span class="sc">$</span>sigma2)))<span class="sc">%*%</span>aux<span class="sc">$</span>X <span class="sc">+</span> <span class="fu">solve</span>(V.prior)</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>      V.bar.inv              <span class="ot">=</span> <span class="fu">invfunc</span>(V.bar.inv)</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>      V.bar                  <span class="ot">=</span> <span class="fu">solve</span>(V.bar.inv)</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>      A.bar                  <span class="ot">=</span> V.bar<span class="sc">%*%</span>(<span class="fu">t</span>(aux<span class="sc">$</span>X)<span class="sc">%*%</span>(aux<span class="sc">$</span>lambda<span class="sc">*</span><span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">as.vector</span>(aux<span class="sc">$</span>sigma2)))<span class="sc">%*%</span>aux<span class="sc">$</span>Y <span class="sc">+</span> <span class="fu">solve</span>(V.prior)<span class="sc">%*%</span>A.prior) </span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>      nu.bar                 <span class="ot">=</span> T <span class="sc">+</span> nu.prior</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>      S.bar                  <span class="ot">=</span> S.prior <span class="sc">+</span> <span class="fu">t</span>(aux<span class="sc">$</span>Y)<span class="sc">%*%</span>(aux<span class="sc">$</span>lambda<span class="sc">*</span><span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">as.vector</span>(aux<span class="sc">$</span>sigma2)))<span class="sc">%*%</span>aux<span class="sc">$</span>Y <span class="sc">+</span> <span class="fu">t</span>(A.prior)<span class="sc">%*%</span><span class="fu">solve</span>(V.prior)<span class="sc">%*%</span>A.prior <span class="sc">-</span> <span class="fu">t</span>(A.bar)<span class="sc">%*%</span>V.bar.inv<span class="sc">%*%</span>A.bar </span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>      S.bar                  <span class="ot">=</span> <span class="fu">invfunc</span>(S.bar)</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>      S.bar.inv              <span class="ot">=</span> <span class="fu">solve</span>(S.bar)</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># posterior draws for A and Sigma</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>      Sigma.posterior.IW     <span class="ot">=</span> <span class="fu">rWishart</span>(<span class="dv">1</span>, <span class="at">df=</span>nu.bar, <span class="at">Sigma=</span>S.bar.inv)</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>      Sigma.posterior.draw   <span class="ot">=</span> <span class="fu">apply</span>(Sigma.posterior.IW, <span class="dv">3</span> ,solve)</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>      aux<span class="sc">$</span>Sigma              <span class="ot">=</span> <span class="fu">array</span>(Sigma.posterior.draw,<span class="fu">c</span>(N,N,<span class="dv">1</span>))</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(aux<span class="sc">$</span>Sigma)[<span class="dv">3</span>]) {</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>          eigen_decomp <span class="ot">&lt;-</span> <span class="fu">eigen</span>(aux<span class="sc">$</span>Sigma[, , i], <span class="at">symmetric =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>          eigen_decomp<span class="sc">$</span>values[eigen_decomp<span class="sc">$</span>values <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>          aux<span class="sc">$</span>Sigma[, , i] <span class="ot">&lt;-</span> eigen_decomp<span class="sc">$</span>vectors <span class="sc">%*%</span> <span class="fu">diag</span>(eigen_decomp<span class="sc">$</span>values) <span class="sc">%*%</span> <span class="fu">t</span>(eigen_decomp<span class="sc">$</span>vectors)</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>      A.norm                 <span class="ot">=</span> <span class="fu">array</span>(<span class="fu">rnorm</span>(<span class="fu">prod</span>(<span class="fu">c</span>(K,N,<span class="dv">1</span>))),<span class="fu">c</span>(K,N,<span class="dv">1</span>))</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>      L                      <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">chol</span>(V.bar))      </span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>      aux<span class="sc">$</span>A                  <span class="ot">=</span> A.bar <span class="sc">+</span> L<span class="sc">%*%</span>A.norm[,,<span class="dv">1</span>]<span class="sc">%*%</span><span class="fu">chol</span>(aux<span class="sc">$</span>Sigma[,,<span class="dv">1</span>])</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>      u.t <span class="ot">=</span> Y<span class="sc">-</span>X<span class="sc">%*%</span>aux<span class="sc">$</span>A</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>      matrix_2x2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(aux<span class="sc">$</span>Sigma, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># posterior draws for lambda</span></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>      lambda.p <span class="ot">=</span> <span class="sc">-</span>N<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span> </span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>      chi.b    <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">diag</span>(<span class="fu">solve</span>(matrix_2x2)<span class="sc">%*%</span><span class="fu">t</span>(u.t)<span class="sc">%*%</span><span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">as.vector</span>(aux<span class="sc">$</span>sigma2))<span class="sc">%*%</span>u.t))</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>      psi.a    <span class="ot">=</span>  <span class="dv">2</span> <span class="sc">/</span> lambda.priors<span class="sc">$</span>alpha</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>      lambda.draw <span class="ot">=</span> GIGrvg<span class="sc">::</span><span class="fu">rgig</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">lambda =</span> lambda.p, <span class="at">chi =</span> chi.b, <span class="at">psi =</span> psi.a)</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>      aux<span class="sc">$</span>lambda <span class="ot">=</span> lambda.draw</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>      <span class="co"># posterior draw for sigma2   </span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>      N             <span class="ot">=</span> <span class="fu">dim</span>(aux<span class="sc">$</span>Y)[<span class="dv">2</span>] </span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>      alpha.st      <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.92677</span>,<span class="fl">1.34744</span>,<span class="fl">0.73504</span>,<span class="fl">0.02266</span>,<span class="dv">0</span><span class="fl">-0.85173</span>,<span class="sc">-</span><span class="fl">1.97278</span>,<span class="sc">-</span><span class="fl">3.46788</span>,<span class="sc">-</span><span class="fl">5.55246</span>,<span class="sc">-</span><span class="fl">8.68384</span>,<span class="sc">-</span><span class="fl">14.65000</span>)</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>      sigma.st      <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.11265</span>,<span class="fl">0.17788</span>,<span class="fl">0.26768</span>,<span class="fl">0.40611</span>,<span class="fl">0.62699</span>,<span class="fl">0.98583</span>,<span class="fl">1.57469</span>,<span class="fl">2.54498</span>,<span class="fl">4.16591</span>,<span class="fl">7.33342</span>)</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>      pi.st         <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.00609</span>,<span class="fl">0.04775</span>,<span class="fl">0.13057</span>,<span class="fl">0.20674</span>,<span class="fl">0.22715</span>,<span class="fl">0.18842</span>,<span class="fl">0.12047</span>,<span class="fl">0.05591</span>,<span class="fl">0.01575</span>,<span class="fl">0.00115</span>)</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>      Lambda        <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">chol</span>(aux<span class="sc">$</span>Sigma[,,<span class="dv">1</span>]))</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>      Z             <span class="ot">=</span> <span class="fu">rowSums</span>( ( aux<span class="sc">$</span>Y <span class="sc">-</span> aux<span class="sc">$</span>X <span class="sc">%*%</span> aux<span class="sc">$</span>A ) <span class="sc">%*%</span> Lambda ) <span class="sc">/</span> <span class="fu">sqrt</span>(N)</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>      Y.tilde       <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">log</span>((Z <span class="sc">+</span> <span class="fl">0.0000001</span>)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>      Ytilde.alpha  <span class="ot">=</span> <span class="fu">as.matrix</span>(Y.tilde <span class="sc">-</span> alpha.st[<span class="fu">as.vector</span>(aux<span class="sc">$</span>s)])</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>      <span class="co"># sampling initial condition</span></span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>      V.h0.bar      <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span> <span class="sc">/</span> h0.v) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">/</span> aux<span class="sc">$</span>sigma.v2))</span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>      m.h0.bar      <span class="ot">=</span> V.h0.bar<span class="sc">*</span>((h0.m <span class="sc">/</span> h0.v) <span class="sc">+</span> (aux<span class="sc">$</span>H[<span class="dv">1</span>] <span class="sc">/</span> aux<span class="sc">$</span>sigma.v2))</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>      h0.draw       <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> m.h0.bar, <span class="at">sd =</span> <span class="fu">sqrt</span>(V.h0.bar))</span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>      aux<span class="sc">$</span>h0        <span class="ot">=</span> h0.draw</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>      <span class="co"># sampling sigma.v2</span></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>      sigma.v2.s    <span class="ot">=</span> sigmav.s <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">c</span>(aux<span class="sc">$</span>H[<span class="dv">1</span>] <span class="sc">-</span> aux<span class="sc">$</span>h0, <span class="fu">diff</span>(aux<span class="sc">$</span>H))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>      sigma.v2.draw <span class="ot">=</span> sigma.v2.s <span class="sc">/</span> <span class="fu">rchisq</span>(<span class="dv">1</span>, sigmav.nu <span class="sc">+</span> T)</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>      aux<span class="sc">$</span>sigma.v2  <span class="ot">=</span> sigma.v2.draw</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>      <span class="co"># sampling auxiliary states</span></span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>      Pr.tmp        <span class="ot">=</span> <span class="fu">simplify2array</span>(<span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="cf">function</span>(x){</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>        <span class="fu">dnorm</span>(Y.tilde, <span class="at">mean =</span> <span class="fu">as.vector</span>(aux<span class="sc">$</span>H <span class="sc">+</span> alpha.st[x]), <span class="at">sd =</span> <span class="fu">sqrt</span>(sigma.st[x]), <span class="at">log =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">log</span>(pi.st[x])</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>      }))</span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>      Pr            <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">apply</span>(Pr.tmp, <span class="dv">1</span>, <span class="cf">function</span>(x){<span class="fu">exp</span>(x <span class="sc">-</span> <span class="fu">max</span>(x)) <span class="sc">/</span> <span class="fu">sum</span>(<span class="fu">exp</span>(x <span class="sc">-</span> <span class="fu">max</span>(x)))}))</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>      s.cum         <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">apply</span>(Pr, <span class="dv">1</span>, cumsum))</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>      r             <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fu">runif</span>(T), <span class="dv">10</span>), <span class="at">ncol =</span> <span class="dv">10</span>)</span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>      ss            <span class="ot">=</span> <span class="fu">apply</span>(s.cum <span class="sc">&lt;</span> r, <span class="dv">1</span>, sum) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>      aux<span class="sc">$</span>s         <span class="ot">=</span> <span class="fu">as.matrix</span>(ss)</span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>      <span class="co"># sampling log-volatilities using functions for tridiagonal precision matrix</span></span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>      Sigma.s.inv   <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span> <span class="sc">/</span> sigma.st[<span class="fu">as.vector</span>(aux<span class="sc">$</span>s)])</span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>      D.inv         <span class="ot">=</span> Sigma.s.inv <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">/</span> aux<span class="sc">$</span>sigma.v2) <span class="sc">*</span> HH</span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>      b             <span class="ot">=</span> <span class="fu">as.matrix</span>(Ytilde.alpha <span class="sc">/</span> sigma.st[<span class="fu">as.vector</span>(aux<span class="sc">$</span>s)] <span class="sc">+</span> (aux<span class="sc">$</span>h0<span class="sc">/</span>aux<span class="sc">$</span>sigma.v2)<span class="sc">*</span><span class="fu">diag</span>(T)[,<span class="dv">1</span>])</span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>      lead.diag     <span class="ot">=</span> <span class="fu">diag</span>(D.inv)</span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>      sub.diag      <span class="ot">=</span> mgcv<span class="sc">::</span><span class="fu">sdiag</span>(D.inv, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>      D.chol        <span class="ot">=</span> mgcv<span class="sc">::</span><span class="fu">trichol</span>(<span class="at">ld =</span> lead.diag, <span class="at">sd =</span> sub.diag)</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>      D.L           <span class="ot">=</span> <span class="fu">diag</span>(D.chol<span class="sc">$</span>ld)</span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>      mgcv<span class="sc">::</span><span class="fu">sdiag</span>(D.L,<span class="sc">-</span><span class="dv">1</span>) <span class="ot">=</span> D.chol<span class="sc">$</span>sd</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>      x             <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">rnorm</span>(T))</span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>      a             <span class="ot">=</span> <span class="fu">forwardsolve</span>(D.L, b)</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>      draw          <span class="ot">=</span> <span class="fu">backsolve</span>(<span class="fu">t</span>(D.L), a <span class="sc">+</span> x)</span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>      aux<span class="sc">$</span>H         <span class="ot">=</span> <span class="fu">as.matrix</span>(draw)</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>      aux<span class="sc">$</span>sigma2    <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">exp</span>(draw))</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>      <span class="co"># output list</span></span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>      posteriors<span class="sc">$</span>H[,s]             <span class="ot">=</span> aux<span class="sc">$</span>H</span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>      posteriors<span class="sc">$</span>sigma2[,s]        <span class="ot">=</span> aux<span class="sc">$</span>sigma2</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>      posteriors<span class="sc">$</span>s[,s]             <span class="ot">=</span> aux<span class="sc">$</span>s</span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a>      posteriors<span class="sc">$</span>h0[s]             <span class="ot">=</span> aux<span class="sc">$</span>h0</span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a>      posteriors<span class="sc">$</span>sigma.v2[s]       <span class="ot">=</span> aux<span class="sc">$</span>sigma.v2</span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a>      posteriors<span class="sc">$</span>A[,,s]            <span class="ot">=</span> aux<span class="sc">$</span>A</span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a>      posteriors<span class="sc">$</span>Sigma[,,s]        <span class="ot">=</span> aux<span class="sc">$</span>Sigma</span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a>      posteriors<span class="sc">$</span>lambda[s]         <span class="ot">=</span> aux<span class="sc">$</span>lambda</span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(posteriors)</span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we also could have A and <span class="math inline">\(\Sigma\)</span>. From where, we can observe the mean of <span class="math inline">\(A_{21},A_{32}\)</span> varying around value of 1.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="empirical-analysis-model-applying-and-forecasing" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Empirical Analysis: Model Applying and Forecasing</h1>
<section id="basic-model" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="basic-model"><span class="header-section-number">5.1</span> Basic Model</h2>
<p>First, set up and read our data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create Y and X</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>y             <span class="ot">=</span> <span class="fu">ts</span>(all_data[,<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(all_data)])     <span class="co"># 10col, 135row</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>Y             <span class="ot">=</span> <span class="fu">ts</span>(y[<span class="dv">13</span><span class="sc">:</span><span class="fu">nrow</span>(y),], <span class="at">frequency=</span><span class="dv">12</span>)      <span class="co"># 10col, 131row</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>X             <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">frequency</span>(Y)){</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  X           <span class="ot">=</span> <span class="fu">cbind</span>(X,y[<span class="dv">13</span><span class="sc">:</span><span class="fu">nrow</span>(y)<span class="sc">-</span>i,])            <span class="co"># 10*4+1=41col, 131row</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Pre-setup </span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>N             <span class="ot">=</span> <span class="fu">ncol</span>(Y)                             <span class="co"># N=10</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>p             <span class="ot">=</span> <span class="fu">frequency</span>(Y)                        <span class="co"># p=4</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>A.hat         <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">%*%</span><span class="fu">t</span>(X)<span class="sc">%*%</span>Y</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>Sigma.hat     <span class="ot">=</span> <span class="fu">t</span>(Y<span class="sc">-</span>X<span class="sc">%*%</span>A.hat)<span class="sc">%*%</span>(Y<span class="sc">-</span>X<span class="sc">%*%</span>A.hat)<span class="sc">/</span><span class="fu">nrow</span>(Y)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior distribution (with Minnesota prior)</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>kappa<span class="fl">.1</span>       <span class="ot">=</span> <span class="fl">0.02</span><span class="sc">^</span><span class="dv">2</span>                                <span class="co"># shrinkage for A1 to Ap</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>kappa<span class="fl">.2</span>       <span class="ot">=</span> <span class="dv">200</span>                                   <span class="co"># shrinkage for constant </span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>A.prior       <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(A.hat),<span class="fu">ncol</span>(A.hat))</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># A.prior[2,1]  = 1</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># A.prior[7,6]  = 1  </span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>A.prior[<span class="dv">2</span><span class="sc">:</span><span class="dv">13</span>,] <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">12</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>V.prior       <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa<span class="fl">.2</span>,kappa<span class="fl">.1</span><span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>S.prior       <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">diag</span>(Sigma.hat))</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>nu.prior      <span class="ot">=</span> N<span class="sc">+</span><span class="dv">2</span> </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>I.matrix            <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="fu">nrow</span>(Y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we could have the mean of A:</p>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.004298</td>
<td style="text-align: center;">-0.023149</td>
<td style="text-align: center;">0.009321</td>
<td style="text-align: center;">-0.001012</td>
<td style="text-align: center;">0.007642</td>
<td style="text-align: center;">0.098861</td>
<td style="text-align: center;">0.028941</td>
<td style="text-align: center;">0.169618</td>
<td style="text-align: center;">-0.005717</td>
<td style="text-align: center;">-0.043994</td>
<td style="text-align: center;">-0.001769</td>
<td style="text-align: center;">-0.001993</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.999792</td>
<td style="text-align: center;">0.000939</td>
<td style="text-align: center;">0.000665</td>
<td style="text-align: center;">0.000641</td>
<td style="text-align: center;">0.000222</td>
<td style="text-align: center;">-0.000385</td>
<td style="text-align: center;">0.000004</td>
<td style="text-align: center;">-0.000886</td>
<td style="text-align: center;">-0.000155</td>
<td style="text-align: center;">0.001099</td>
<td style="text-align: center;">0.000135</td>
<td style="text-align: center;">0.000051</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000403</td>
<td style="text-align: center;">1.000012</td>
<td style="text-align: center;">-0.000220</td>
<td style="text-align: center;">0.000560</td>
<td style="text-align: center;">0.000127</td>
<td style="text-align: center;">0.001208</td>
<td style="text-align: center;">-0.002601</td>
<td style="text-align: center;">-0.002799</td>
<td style="text-align: center;">0.000251</td>
<td style="text-align: center;">0.002998</td>
<td style="text-align: center;">-0.000163</td>
<td style="text-align: center;">0.000475</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.000471</td>
<td style="text-align: center;">0.001538</td>
<td style="text-align: center;">0.997579</td>
<td style="text-align: center;">-0.001917</td>
<td style="text-align: center;">-0.000680</td>
<td style="text-align: center;">-0.002079</td>
<td style="text-align: center;">-0.001250</td>
<td style="text-align: center;">-0.001013</td>
<td style="text-align: center;">0.000229</td>
<td style="text-align: center;">0.002503</td>
<td style="text-align: center;">-0.000188</td>
<td style="text-align: center;">0.000955</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000407</td>
<td style="text-align: center;">0.000160</td>
<td style="text-align: center;">-0.002930</td>
<td style="text-align: center;">0.997198</td>
<td style="text-align: center;">-0.000671</td>
<td style="text-align: center;">-0.000973</td>
<td style="text-align: center;">-0.001437</td>
<td style="text-align: center;">0.000079</td>
<td style="text-align: center;">0.000044</td>
<td style="text-align: center;">0.000674</td>
<td style="text-align: center;">-0.000206</td>
<td style="text-align: center;">0.000659</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000093</td>
<td style="text-align: center;">0.001903</td>
<td style="text-align: center;">0.001711</td>
<td style="text-align: center;">0.001530</td>
<td style="text-align: center;">1.000143</td>
<td style="text-align: center;">-0.001062</td>
<td style="text-align: center;">0.002730</td>
<td style="text-align: center;">-0.003802</td>
<td style="text-align: center;">0.000206</td>
<td style="text-align: center;">0.002266</td>
<td style="text-align: center;">0.000121</td>
<td style="text-align: center;">0.000506</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000272</td>
<td style="text-align: center;">-0.002239</td>
<td style="text-align: center;">0.000352</td>
<td style="text-align: center;">0.000327</td>
<td style="text-align: center;">0.000451</td>
<td style="text-align: center;">0.909861</td>
<td style="text-align: center;">-0.001616</td>
<td style="text-align: center;">0.026858</td>
<td style="text-align: center;">0.001181</td>
<td style="text-align: center;">-0.003858</td>
<td style="text-align: center;">-0.000039</td>
<td style="text-align: center;">-0.001430</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000358</td>
<td style="text-align: center;">0.006131</td>
<td style="text-align: center;">0.002884</td>
<td style="text-align: center;">0.001598</td>
<td style="text-align: center;">-0.001214</td>
<td style="text-align: center;">-0.001994</td>
<td style="text-align: center;">0.994742</td>
<td style="text-align: center;">-0.003491</td>
<td style="text-align: center;">-0.001531</td>
<td style="text-align: center;">0.005625</td>
<td style="text-align: center;">0.000498</td>
<td style="text-align: center;">0.001547</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000398</td>
<td style="text-align: center;">-0.001878</td>
<td style="text-align: center;">-0.001815</td>
<td style="text-align: center;">-0.000834</td>
<td style="text-align: center;">0.000638</td>
<td style="text-align: center;">-0.007863</td>
<td style="text-align: center;">0.001783</td>
<td style="text-align: center;">0.983310</td>
<td style="text-align: center;">0.003099</td>
<td style="text-align: center;">-0.001487</td>
<td style="text-align: center;">-0.000178</td>
<td style="text-align: center;">-0.001369</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000224</td>
<td style="text-align: center;">0.000380</td>
<td style="text-align: center;">0.000093</td>
<td style="text-align: center;">0.000022</td>
<td style="text-align: center;">-0.000154</td>
<td style="text-align: center;">0.002932</td>
<td style="text-align: center;">0.001291</td>
<td style="text-align: center;">-0.004438</td>
<td style="text-align: center;">0.999020</td>
<td style="text-align: center;">0.001005</td>
<td style="text-align: center;">0.000168</td>
<td style="text-align: center;">0.001034</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000425</td>
<td style="text-align: center;">-0.002590</td>
<td style="text-align: center;">-0.001208</td>
<td style="text-align: center;">-0.000128</td>
<td style="text-align: center;">0.000119</td>
<td style="text-align: center;">0.001178</td>
<td style="text-align: center;">-0.002902</td>
<td style="text-align: center;">0.000402</td>
<td style="text-align: center;">0.000061</td>
<td style="text-align: center;">0.998902</td>
<td style="text-align: center;">-0.000156</td>
<td style="text-align: center;">0.000472</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.000036</td>
<td style="text-align: center;">0.000250</td>
<td style="text-align: center;">0.000086</td>
<td style="text-align: center;">0.000125</td>
<td style="text-align: center;">0.000007</td>
<td style="text-align: center;">-0.000054</td>
<td style="text-align: center;">-0.000391</td>
<td style="text-align: center;">-0.000017</td>
<td style="text-align: center;">0.000011</td>
<td style="text-align: center;">0.000256</td>
<td style="text-align: center;">0.999962</td>
<td style="text-align: center;">-0.000148</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>And, we could have the mean of <span class="math inline">\(\Sigma\)</span>:</p>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.002077</td>
<td style="text-align: center;">-0.001460</td>
<td style="text-align: center;">-0.004480</td>
<td style="text-align: center;">-0.003864</td>
<td style="text-align: center;">-0.000069</td>
<td style="text-align: center;">0.002707</td>
<td style="text-align: center;">0.000642</td>
<td style="text-align: center;">-0.000320</td>
<td style="text-align: center;">0.000595</td>
<td style="text-align: center;">-0.000090</td>
<td style="text-align: center;">-0.000401</td>
<td style="text-align: center;">-0.000514</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.001460</td>
<td style="text-align: center;">0.042012</td>
<td style="text-align: center;">0.022136</td>
<td style="text-align: center;">0.015871</td>
<td style="text-align: center;">0.004942</td>
<td style="text-align: center;">-0.053876</td>
<td style="text-align: center;">0.002678</td>
<td style="text-align: center;">0.009787</td>
<td style="text-align: center;">0.009400</td>
<td style="text-align: center;">0.024394</td>
<td style="text-align: center;">0.000227</td>
<td style="text-align: center;">-0.011441</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-0.004480</td>
<td style="text-align: center;">0.022136</td>
<td style="text-align: center;">0.072509</td>
<td style="text-align: center;">0.064367</td>
<td style="text-align: center;">0.004745</td>
<td style="text-align: center;">-0.037687</td>
<td style="text-align: center;">0.025309</td>
<td style="text-align: center;">0.004077</td>
<td style="text-align: center;">0.006626</td>
<td style="text-align: center;">0.010169</td>
<td style="text-align: center;">0.001697</td>
<td style="text-align: center;">-0.011639</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.003864</td>
<td style="text-align: center;">0.015871</td>
<td style="text-align: center;">0.064367</td>
<td style="text-align: center;">0.064672</td>
<td style="text-align: center;">0.003739</td>
<td style="text-align: center;">-0.024884</td>
<td style="text-align: center;">0.032114</td>
<td style="text-align: center;">0.002651</td>
<td style="text-align: center;">0.006129</td>
<td style="text-align: center;">0.007076</td>
<td style="text-align: center;">0.001377</td>
<td style="text-align: center;">-0.008689</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-0.000069</td>
<td style="text-align: center;">0.004942</td>
<td style="text-align: center;">0.004745</td>
<td style="text-align: center;">0.003739</td>
<td style="text-align: center;">0.003449</td>
<td style="text-align: center;">-0.011498</td>
<td style="text-align: center;">-0.000407</td>
<td style="text-align: center;">0.006679</td>
<td style="text-align: center;">0.002660</td>
<td style="text-align: center;">0.001892</td>
<td style="text-align: center;">-0.000346</td>
<td style="text-align: center;">-0.009340</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.002707</td>
<td style="text-align: center;">-0.053876</td>
<td style="text-align: center;">-0.037687</td>
<td style="text-align: center;">-0.024884</td>
<td style="text-align: center;">-0.011498</td>
<td style="text-align: center;">1.763861</td>
<td style="text-align: center;">0.028616</td>
<td style="text-align: center;">-0.098711</td>
<td style="text-align: center;">-0.042208</td>
<td style="text-align: center;">-0.011745</td>
<td style="text-align: center;">-0.001098</td>
<td style="text-align: center;">0.020573</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000642</td>
<td style="text-align: center;">0.002678</td>
<td style="text-align: center;">0.025309</td>
<td style="text-align: center;">0.032114</td>
<td style="text-align: center;">-0.000407</td>
<td style="text-align: center;">0.028616</td>
<td style="text-align: center;">0.255045</td>
<td style="text-align: center;">-0.093297</td>
<td style="text-align: center;">0.008922</td>
<td style="text-align: center;">0.016572</td>
<td style="text-align: center;">-0.000345</td>
<td style="text-align: center;">0.006370</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000320</td>
<td style="text-align: center;">0.009787</td>
<td style="text-align: center;">0.004077</td>
<td style="text-align: center;">0.002651</td>
<td style="text-align: center;">0.006679</td>
<td style="text-align: center;">-0.098711</td>
<td style="text-align: center;">-0.093297</td>
<td style="text-align: center;">0.411516</td>
<td style="text-align: center;">0.005838</td>
<td style="text-align: center;">-0.029506</td>
<td style="text-align: center;">0.000315</td>
<td style="text-align: center;">-0.030378</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000595</td>
<td style="text-align: center;">0.009400</td>
<td style="text-align: center;">0.006626</td>
<td style="text-align: center;">0.006129</td>
<td style="text-align: center;">0.002660</td>
<td style="text-align: center;">-0.042208</td>
<td style="text-align: center;">0.008922</td>
<td style="text-align: center;">0.005838</td>
<td style="text-align: center;">0.015545</td>
<td style="text-align: center;">0.004678</td>
<td style="text-align: center;">-0.000684</td>
<td style="text-align: center;">-0.008457</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000090</td>
<td style="text-align: center;">0.024394</td>
<td style="text-align: center;">0.010169</td>
<td style="text-align: center;">0.007076</td>
<td style="text-align: center;">0.001892</td>
<td style="text-align: center;">-0.011745</td>
<td style="text-align: center;">0.016572</td>
<td style="text-align: center;">-0.029506</td>
<td style="text-align: center;">0.004678</td>
<td style="text-align: center;">0.031831</td>
<td style="text-align: center;">-0.000133</td>
<td style="text-align: center;">-0.003685</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-0.000401</td>
<td style="text-align: center;">0.000227</td>
<td style="text-align: center;">0.001697</td>
<td style="text-align: center;">0.001377</td>
<td style="text-align: center;">-0.000346</td>
<td style="text-align: center;">-0.001098</td>
<td style="text-align: center;">-0.000345</td>
<td style="text-align: center;">0.000315</td>
<td style="text-align: center;">-0.000684</td>
<td style="text-align: center;">-0.000133</td>
<td style="text-align: center;">0.000464</td>
<td style="text-align: center;">0.001354</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000514</td>
<td style="text-align: center;">-0.011441</td>
<td style="text-align: center;">-0.011639</td>
<td style="text-align: center;">-0.008689</td>
<td style="text-align: center;">-0.009340</td>
<td style="text-align: center;">0.020573</td>
<td style="text-align: center;">0.006370</td>
<td style="text-align: center;">-0.030378</td>
<td style="text-align: center;">-0.008457</td>
<td style="text-align: center;">-0.003685</td>
<td style="text-align: center;">0.001354</td>
<td style="text-align: center;">0.048256</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Therefore, we could have histogram and time series of A for Gibbs sampler:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 6 Histograms and trace plots on key variables using basic model</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>we could clearly see that underling our Minnesota prior assumption, a high level of shrinkage of random walk process, Gold have its first lag coefficient really close to 1, and other variables close to 0. This support our basic understanding of Gold nature, a safe assets.</p>
<p>Following presents a 3D visualization of the density intervals for the log Gold Future Prices and Log Nasdaq Index points. From past trends we could clearly see that negative correlations between those two. When the market suffered from dot-com and global financial crisis during 2000 to 2012, Gold futures increase sharply as expectation of risks, market returns fluctuations a lot. For next 24 months forecasting based on benchmark model, we could see Log gold future price more sharply increase then Log Nasdaq Index points. The varying heights of the intervals reflect the level of prediction certainty; as we project further into the future, the intervals become wider and more dispersed due to increased uncertainty.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-40-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Above graphs we conducted a time series forecast analysis on the gold price (lgold) and the Nasdaq index (LNasIndex) and plotted a comparison chart between the actual data and the forecast results.</p>
<p>Gold price (lgold) From 2000 to 2024, the gold price showed an overall upward trend. The blue shaded area represents the 90% of confidence interval of the forecast value, which gradually widens over time, indicating an increase in forecast uncertainty. The forecast trend line (solid blue line) indicates that the gold price may continue to rise, but the dispersion of the forecast values indicates that future price fluctuations are large.</p>
<p>Nasdaq index (LNasIndex) Same as lgold, the Nasdaq index also showed an upward trend, although it fluctuated greatly during the period. The red shaded area represents the 90% of confidence interval of the forecast value, which indicating an increase in forecast uncertainty. The forecast trend line (solid red line) shows that the Nasdaq index may continue to rise in long run, but there is also great uncertainty.</p>
<p>The width of the confidence interval shows that the range of future changes will increase as the forecast period increases. Investors should take these uncertainties into account when making decisions and conduct corresponding risk management.</p>
</section>
<section id="extension-model" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="extension-model"><span class="header-section-number">5.2</span> Extension Model</h2>
<p>Due to the tediousness of computer calculations, we simplified the number of iterations to extend the predictions of the basic model. Although the results are not satisfactory, they also assist and strengthen the views we have obtained in the basic model.</p>
<section id="laplace-ditribution-of-errors" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="laplace-ditribution-of-errors"><span class="header-section-number">5.2.1</span> Laplace Ditribution of errors</h3>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.004429</td>
<td style="text-align: center;">0.016218</td>
<td style="text-align: center;">-0.000813</td>
<td style="text-align: center;">-0.016809</td>
<td style="text-align: center;">0.011316</td>
<td style="text-align: center;">0.053302</td>
<td style="text-align: center;">0.036399</td>
<td style="text-align: center;">-0.011717</td>
<td style="text-align: center;">0.011843</td>
<td style="text-align: center;">0.015110</td>
<td style="text-align: center;">-0.002494</td>
<td style="text-align: center;">-0.011072</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.999734</td>
<td style="text-align: center;">0.000346</td>
<td style="text-align: center;">0.001073</td>
<td style="text-align: center;">0.001216</td>
<td style="text-align: center;">0.000342</td>
<td style="text-align: center;">0.001801</td>
<td style="text-align: center;">0.000317</td>
<td style="text-align: center;">-0.000544</td>
<td style="text-align: center;">0.000036</td>
<td style="text-align: center;">0.000137</td>
<td style="text-align: center;">0.000103</td>
<td style="text-align: center;">-0.000938</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000408</td>
<td style="text-align: center;">1.000709</td>
<td style="text-align: center;">-0.000028</td>
<td style="text-align: center;">0.000288</td>
<td style="text-align: center;">-0.000038</td>
<td style="text-align: center;">0.001630</td>
<td style="text-align: center;">-0.000685</td>
<td style="text-align: center;">0.001445</td>
<td style="text-align: center;">0.000741</td>
<td style="text-align: center;">0.001770</td>
<td style="text-align: center;">-0.000115</td>
<td style="text-align: center;">0.000821</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.000404</td>
<td style="text-align: center;">0.001476</td>
<td style="text-align: center;">0.998543</td>
<td style="text-align: center;">-0.001402</td>
<td style="text-align: center;">-0.000619</td>
<td style="text-align: center;">-0.001453</td>
<td style="text-align: center;">-0.000351</td>
<td style="text-align: center;">0.002754</td>
<td style="text-align: center;">0.000448</td>
<td style="text-align: center;">0.002183</td>
<td style="text-align: center;">-0.000137</td>
<td style="text-align: center;">0.001172</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000425</td>
<td style="text-align: center;">0.000687</td>
<td style="text-align: center;">-0.001911</td>
<td style="text-align: center;">0.997775</td>
<td style="text-align: center;">-0.000477</td>
<td style="text-align: center;">-0.003386</td>
<td style="text-align: center;">0.000545</td>
<td style="text-align: center;">0.003739</td>
<td style="text-align: center;">0.000166</td>
<td style="text-align: center;">0.000805</td>
<td style="text-align: center;">-0.000166</td>
<td style="text-align: center;">0.000973</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000198</td>
<td style="text-align: center;">0.000863</td>
<td style="text-align: center;">0.001217</td>
<td style="text-align: center;">0.001299</td>
<td style="text-align: center;">1.000083</td>
<td style="text-align: center;">0.000632</td>
<td style="text-align: center;">0.001077</td>
<td style="text-align: center;">-0.002254</td>
<td style="text-align: center;">-0.000097</td>
<td style="text-align: center;">0.000722</td>
<td style="text-align: center;">0.000163</td>
<td style="text-align: center;">-0.000117</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000259</td>
<td style="text-align: center;">-0.001301</td>
<td style="text-align: center;">-0.000534</td>
<td style="text-align: center;">-0.000417</td>
<td style="text-align: center;">-0.000044</td>
<td style="text-align: center;">0.942566</td>
<td style="text-align: center;">0.001652</td>
<td style="text-align: center;">-0.000418</td>
<td style="text-align: center;">0.000383</td>
<td style="text-align: center;">-0.000589</td>
<td style="text-align: center;">-0.000174</td>
<td style="text-align: center;">0.000306</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000157</td>
<td style="text-align: center;">0.003557</td>
<td style="text-align: center;">0.001984</td>
<td style="text-align: center;">0.001064</td>
<td style="text-align: center;">-0.000695</td>
<td style="text-align: center;">0.001466</td>
<td style="text-align: center;">0.996376</td>
<td style="text-align: center;">-0.003802</td>
<td style="text-align: center;">-0.000339</td>
<td style="text-align: center;">0.003451</td>
<td style="text-align: center;">0.000284</td>
<td style="text-align: center;">0.000706</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000230</td>
<td style="text-align: center;">-0.001800</td>
<td style="text-align: center;">-0.001241</td>
<td style="text-align: center;">-0.000493</td>
<td style="text-align: center;">0.000430</td>
<td style="text-align: center;">-0.004680</td>
<td style="text-align: center;">0.001354</td>
<td style="text-align: center;">0.998588</td>
<td style="text-align: center;">0.000451</td>
<td style="text-align: center;">-0.001672</td>
<td style="text-align: center;">-0.000145</td>
<td style="text-align: center;">-0.000937</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000167</td>
<td style="text-align: center;">0.000167</td>
<td style="text-align: center;">0.000355</td>
<td style="text-align: center;">0.000531</td>
<td style="text-align: center;">-0.000002</td>
<td style="text-align: center;">0.002449</td>
<td style="text-align: center;">-0.001092</td>
<td style="text-align: center;">-0.000583</td>
<td style="text-align: center;">0.999293</td>
<td style="text-align: center;">0.000182</td>
<td style="text-align: center;">0.000138</td>
<td style="text-align: center;">0.000604</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000243</td>
<td style="text-align: center;">-0.000132</td>
<td style="text-align: center;">0.000079</td>
<td style="text-align: center;">0.000505</td>
<td style="text-align: center;">-0.000018</td>
<td style="text-align: center;">-0.004482</td>
<td style="text-align: center;">-0.000714</td>
<td style="text-align: center;">0.000983</td>
<td style="text-align: center;">0.000454</td>
<td style="text-align: center;">1.000265</td>
<td style="text-align: center;">-0.000033</td>
<td style="text-align: center;">0.000807</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.000213</td>
<td style="text-align: center;">-0.000120</td>
<td style="text-align: center;">-0.000872</td>
<td style="text-align: center;">-0.000810</td>
<td style="text-align: center;">-0.000033</td>
<td style="text-align: center;">0.001899</td>
<td style="text-align: center;">0.000491</td>
<td style="text-align: center;">0.000477</td>
<td style="text-align: center;">0.000262</td>
<td style="text-align: center;">-0.000028</td>
<td style="text-align: center;">0.999925</td>
<td style="text-align: center;">0.000431</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.001556</td>
<td style="text-align: center;">-0.000247</td>
<td style="text-align: center;">-0.002559</td>
<td style="text-align: center;">-0.002315</td>
<td style="text-align: center;">0.000046</td>
<td style="text-align: center;">-0.000164</td>
<td style="text-align: center;">0.000635</td>
<td style="text-align: center;">0.000061</td>
<td style="text-align: center;">0.000373</td>
<td style="text-align: center;">-0.000026</td>
<td style="text-align: center;">-0.000324</td>
<td style="text-align: center;">0.000090</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000247</td>
<td style="text-align: center;">0.012832</td>
<td style="text-align: center;">0.005426</td>
<td style="text-align: center;">0.003904</td>
<td style="text-align: center;">0.000238</td>
<td style="text-align: center;">-0.002567</td>
<td style="text-align: center;">-0.000848</td>
<td style="text-align: center;">-0.001356</td>
<td style="text-align: center;">0.001395</td>
<td style="text-align: center;">0.006807</td>
<td style="text-align: center;">0.000156</td>
<td style="text-align: center;">-0.000688</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-0.002559</td>
<td style="text-align: center;">0.005426</td>
<td style="text-align: center;">0.046399</td>
<td style="text-align: center;">0.042608</td>
<td style="text-align: center;">0.001715</td>
<td style="text-align: center;">0.001395</td>
<td style="text-align: center;">0.011173</td>
<td style="text-align: center;">-0.001295</td>
<td style="text-align: center;">0.003922</td>
<td style="text-align: center;">0.001354</td>
<td style="text-align: center;">0.000786</td>
<td style="text-align: center;">-0.004668</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.002315</td>
<td style="text-align: center;">0.003904</td>
<td style="text-align: center;">0.042608</td>
<td style="text-align: center;">0.043830</td>
<td style="text-align: center;">0.001711</td>
<td style="text-align: center;">-0.001361</td>
<td style="text-align: center;">0.013296</td>
<td style="text-align: center;">-0.001635</td>
<td style="text-align: center;">0.004236</td>
<td style="text-align: center;">0.000666</td>
<td style="text-align: center;">0.000498</td>
<td style="text-align: center;">-0.004248</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000046</td>
<td style="text-align: center;">0.000238</td>
<td style="text-align: center;">0.001715</td>
<td style="text-align: center;">0.001711</td>
<td style="text-align: center;">0.001759</td>
<td style="text-align: center;">-0.001009</td>
<td style="text-align: center;">-0.000532</td>
<td style="text-align: center;">0.000040</td>
<td style="text-align: center;">0.000430</td>
<td style="text-align: center;">-0.000273</td>
<td style="text-align: center;">-0.000196</td>
<td style="text-align: center;">-0.004581</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000164</td>
<td style="text-align: center;">-0.002567</td>
<td style="text-align: center;">0.001395</td>
<td style="text-align: center;">-0.001361</td>
<td style="text-align: center;">-0.001009</td>
<td style="text-align: center;">1.053716</td>
<td style="text-align: center;">0.003187</td>
<td style="text-align: center;">-0.001863</td>
<td style="text-align: center;">-0.002719</td>
<td style="text-align: center;">-0.003805</td>
<td style="text-align: center;">0.000753</td>
<td style="text-align: center;">-0.000002</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000635</td>
<td style="text-align: center;">-0.000848</td>
<td style="text-align: center;">0.011173</td>
<td style="text-align: center;">0.013296</td>
<td style="text-align: center;">-0.000532</td>
<td style="text-align: center;">0.003187</td>
<td style="text-align: center;">0.119232</td>
<td style="text-align: center;">-0.004267</td>
<td style="text-align: center;">0.007433</td>
<td style="text-align: center;">0.000634</td>
<td style="text-align: center;">-0.000490</td>
<td style="text-align: center;">0.004980</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.000061</td>
<td style="text-align: center;">-0.001356</td>
<td style="text-align: center;">-0.001295</td>
<td style="text-align: center;">-0.001635</td>
<td style="text-align: center;">0.000040</td>
<td style="text-align: center;">-0.001863</td>
<td style="text-align: center;">-0.004267</td>
<td style="text-align: center;">0.039166</td>
<td style="text-align: center;">-0.001043</td>
<td style="text-align: center;">-0.001839</td>
<td style="text-align: center;">0.000037</td>
<td style="text-align: center;">0.000625</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000373</td>
<td style="text-align: center;">0.001395</td>
<td style="text-align: center;">0.003922</td>
<td style="text-align: center;">0.004236</td>
<td style="text-align: center;">0.000430</td>
<td style="text-align: center;">-0.002719</td>
<td style="text-align: center;">0.007433</td>
<td style="text-align: center;">-0.001043</td>
<td style="text-align: center;">0.007201</td>
<td style="text-align: center;">0.000787</td>
<td style="text-align: center;">-0.000365</td>
<td style="text-align: center;">-0.001868</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000026</td>
<td style="text-align: center;">0.006807</td>
<td style="text-align: center;">0.001354</td>
<td style="text-align: center;">0.000666</td>
<td style="text-align: center;">-0.000273</td>
<td style="text-align: center;">-0.003805</td>
<td style="text-align: center;">0.000634</td>
<td style="text-align: center;">-0.001839</td>
<td style="text-align: center;">0.000787</td>
<td style="text-align: center;">0.009794</td>
<td style="text-align: center;">-0.000068</td>
<td style="text-align: center;">-0.000045</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-0.000324</td>
<td style="text-align: center;">0.000156</td>
<td style="text-align: center;">0.000786</td>
<td style="text-align: center;">0.000498</td>
<td style="text-align: center;">-0.000196</td>
<td style="text-align: center;">0.000753</td>
<td style="text-align: center;">-0.000490</td>
<td style="text-align: center;">0.000037</td>
<td style="text-align: center;">-0.000365</td>
<td style="text-align: center;">-0.000068</td>
<td style="text-align: center;">0.000333</td>
<td style="text-align: center;">0.000651</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.000090</td>
<td style="text-align: center;">-0.000688</td>
<td style="text-align: center;">-0.004668</td>
<td style="text-align: center;">-0.004248</td>
<td style="text-align: center;">-0.004581</td>
<td style="text-align: center;">-0.000002</td>
<td style="text-align: center;">0.004980</td>
<td style="text-align: center;">0.000625</td>
<td style="text-align: center;">-0.001868</td>
<td style="text-align: center;">-0.000045</td>
<td style="text-align: center;">0.000651</td>
<td style="text-align: center;">0.030938</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-48-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="stochastic-volatility" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="stochastic-volatility"><span class="header-section-number">5.2.2</span> Stochastic Volatility</h3>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.006014</td>
<td style="text-align: center;">0.026495</td>
<td style="text-align: center;">0.047680</td>
<td style="text-align: center;">0.038882</td>
<td style="text-align: center;">0.010155</td>
<td style="text-align: center;">-0.025184</td>
<td style="text-align: center;">0.070029</td>
<td style="text-align: center;">-0.030703</td>
<td style="text-align: center;">0.020465</td>
<td style="text-align: center;">0.024434</td>
<td style="text-align: center;">0.000347</td>
<td style="text-align: center;">0.009250</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.999942</td>
<td style="text-align: center;">-0.000074</td>
<td style="text-align: center;">-0.000052</td>
<td style="text-align: center;">-0.000008</td>
<td style="text-align: center;">0.000010</td>
<td style="text-align: center;">-0.001523</td>
<td style="text-align: center;">0.000604</td>
<td style="text-align: center;">0.000143</td>
<td style="text-align: center;">0.000068</td>
<td style="text-align: center;">0.000054</td>
<td style="text-align: center;">0.000005</td>
<td style="text-align: center;">-0.000065</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-0.000006</td>
<td style="text-align: center;">0.999952</td>
<td style="text-align: center;">0.000139</td>
<td style="text-align: center;">0.000229</td>
<td style="text-align: center;">-0.000015</td>
<td style="text-align: center;">0.000369</td>
<td style="text-align: center;">-0.000618</td>
<td style="text-align: center;">-0.000982</td>
<td style="text-align: center;">0.000045</td>
<td style="text-align: center;">0.000443</td>
<td style="text-align: center;">0.000006</td>
<td style="text-align: center;">0.000268</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.000096</td>
<td style="text-align: center;">0.000427</td>
<td style="text-align: center;">0.999564</td>
<td style="text-align: center;">-0.000456</td>
<td style="text-align: center;">-0.000015</td>
<td style="text-align: center;">-0.002134</td>
<td style="text-align: center;">-0.000230</td>
<td style="text-align: center;">-0.000599</td>
<td style="text-align: center;">-0.000071</td>
<td style="text-align: center;">0.000412</td>
<td style="text-align: center;">-0.000031</td>
<td style="text-align: center;">-0.000367</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000031</td>
<td style="text-align: center;">0.000085</td>
<td style="text-align: center;">-0.000273</td>
<td style="text-align: center;">0.999757</td>
<td style="text-align: center;">-0.000074</td>
<td style="text-align: center;">-0.000314</td>
<td style="text-align: center;">-0.000464</td>
<td style="text-align: center;">0.000596</td>
<td style="text-align: center;">0.000078</td>
<td style="text-align: center;">0.000240</td>
<td style="text-align: center;">-0.000033</td>
<td style="text-align: center;">0.000075</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000057</td>
<td style="text-align: center;">0.000140</td>
<td style="text-align: center;">0.000221</td>
<td style="text-align: center;">0.000252</td>
<td style="text-align: center;">0.999987</td>
<td style="text-align: center;">-0.000937</td>
<td style="text-align: center;">0.000179</td>
<td style="text-align: center;">-0.000493</td>
<td style="text-align: center;">0.000056</td>
<td style="text-align: center;">0.000231</td>
<td style="text-align: center;">0.000022</td>
<td style="text-align: center;">-0.000031</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-0.000045</td>
<td style="text-align: center;">-0.000167</td>
<td style="text-align: center;">0.000312</td>
<td style="text-align: center;">0.000332</td>
<td style="text-align: center;">-0.000017</td>
<td style="text-align: center;">0.987669</td>
<td style="text-align: center;">0.000060</td>
<td style="text-align: center;">0.002553</td>
<td style="text-align: center;">0.000016</td>
<td style="text-align: center;">-0.000298</td>
<td style="text-align: center;">0.000012</td>
<td style="text-align: center;">0.000112</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.000002</td>
<td style="text-align: center;">0.000597</td>
<td style="text-align: center;">0.000371</td>
<td style="text-align: center;">0.000090</td>
<td style="text-align: center;">-0.000146</td>
<td style="text-align: center;">0.000668</td>
<td style="text-align: center;">0.999410</td>
<td style="text-align: center;">-0.000193</td>
<td style="text-align: center;">-0.000305</td>
<td style="text-align: center;">0.000542</td>
<td style="text-align: center;">0.000059</td>
<td style="text-align: center;">0.000107</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000067</td>
<td style="text-align: center;">-0.000361</td>
<td style="text-align: center;">-0.000565</td>
<td style="text-align: center;">-0.000421</td>
<td style="text-align: center;">0.000071</td>
<td style="text-align: center;">-0.001161</td>
<td style="text-align: center;">0.000105</td>
<td style="text-align: center;">0.998272</td>
<td style="text-align: center;">0.000277</td>
<td style="text-align: center;">-0.000375</td>
<td style="text-align: center;">-0.000045</td>
<td style="text-align: center;">-0.000088</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000011</td>
<td style="text-align: center;">0.000271</td>
<td style="text-align: center;">-0.000080</td>
<td style="text-align: center;">-0.000056</td>
<td style="text-align: center;">-0.000011</td>
<td style="text-align: center;">-0.000677</td>
<td style="text-align: center;">-0.000295</td>
<td style="text-align: center;">-0.000481</td>
<td style="text-align: center;">0.999802</td>
<td style="text-align: center;">0.000280</td>
<td style="text-align: center;">-0.000003</td>
<td style="text-align: center;">0.000124</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000061</td>
<td style="text-align: center;">-0.000417</td>
<td style="text-align: center;">-0.000191</td>
<td style="text-align: center;">-0.000117</td>
<td style="text-align: center;">-0.000009</td>
<td style="text-align: center;">-0.000577</td>
<td style="text-align: center;">-0.000290</td>
<td style="text-align: center;">0.000689</td>
<td style="text-align: center;">0.000073</td>
<td style="text-align: center;">0.999736</td>
<td style="text-align: center;">-0.000017</td>
<td style="text-align: center;">0.000063</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.000032</td>
<td style="text-align: center;">0.000082</td>
<td style="text-align: center;">-0.000103</td>
<td style="text-align: center;">-0.000004</td>
<td style="text-align: center;">0.000036</td>
<td style="text-align: center;">-0.000476</td>
<td style="text-align: center;">-0.000083</td>
<td style="text-align: center;">-0.000037</td>
<td style="text-align: center;">0.000204</td>
<td style="text-align: center;">0.000107</td>
<td style="text-align: center;">0.999983</td>
<td style="text-align: center;">-0.000119</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.000359</td>
<td style="text-align: center;">-0.000021</td>
<td style="text-align: center;">-0.000589</td>
<td style="text-align: center;">-0.000499</td>
<td style="text-align: center;">0.000023</td>
<td style="text-align: center;">-0.000789</td>
<td style="text-align: center;">0.000075</td>
<td style="text-align: center;">0.000049</td>
<td style="text-align: center;">0.000095</td>
<td style="text-align: center;">0.000049</td>
<td style="text-align: center;">-0.000077</td>
<td style="text-align: center;">-0.000026</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000021</td>
<td style="text-align: center;">0.004932</td>
<td style="text-align: center;">0.002117</td>
<td style="text-align: center;">0.001666</td>
<td style="text-align: center;">0.000277</td>
<td style="text-align: center;">-0.005084</td>
<td style="text-align: center;">0.000878</td>
<td style="text-align: center;">0.000289</td>
<td style="text-align: center;">0.000994</td>
<td style="text-align: center;">0.002407</td>
<td style="text-align: center;">0.000013</td>
<td style="text-align: center;">-0.000587</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-0.000589</td>
<td style="text-align: center;">0.002117</td>
<td style="text-align: center;">0.010360</td>
<td style="text-align: center;">0.009322</td>
<td style="text-align: center;">0.000318</td>
<td style="text-align: center;">-0.001336</td>
<td style="text-align: center;">0.002861</td>
<td style="text-align: center;">0.000867</td>
<td style="text-align: center;">0.000940</td>
<td style="text-align: center;">0.000694</td>
<td style="text-align: center;">0.000182</td>
<td style="text-align: center;">-0.001085</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000499</td>
<td style="text-align: center;">0.001666</td>
<td style="text-align: center;">0.009322</td>
<td style="text-align: center;">0.009788</td>
<td style="text-align: center;">0.000288</td>
<td style="text-align: center;">-0.001384</td>
<td style="text-align: center;">0.003300</td>
<td style="text-align: center;">0.000206</td>
<td style="text-align: center;">0.001037</td>
<td style="text-align: center;">0.000587</td>
<td style="text-align: center;">0.000107</td>
<td style="text-align: center;">-0.001053</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000023</td>
<td style="text-align: center;">0.000277</td>
<td style="text-align: center;">0.000318</td>
<td style="text-align: center;">0.000288</td>
<td style="text-align: center;">0.000440</td>
<td style="text-align: center;">-0.000675</td>
<td style="text-align: center;">0.000018</td>
<td style="text-align: center;">0.000520</td>
<td style="text-align: center;">0.000245</td>
<td style="text-align: center;">0.000062</td>
<td style="text-align: center;">-0.000064</td>
<td style="text-align: center;">-0.001263</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000789</td>
<td style="text-align: center;">-0.005084</td>
<td style="text-align: center;">-0.001336</td>
<td style="text-align: center;">-0.001384</td>
<td style="text-align: center;">-0.000675</td>
<td style="text-align: center;">0.274415</td>
<td style="text-align: center;">0.000137</td>
<td style="text-align: center;">-0.007584</td>
<td style="text-align: center;">-0.004730</td>
<td style="text-align: center;">-0.002688</td>
<td style="text-align: center;">0.000284</td>
<td style="text-align: center;">0.001381</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000075</td>
<td style="text-align: center;">0.000878</td>
<td style="text-align: center;">0.002861</td>
<td style="text-align: center;">0.003300</td>
<td style="text-align: center;">0.000018</td>
<td style="text-align: center;">0.000137</td>
<td style="text-align: center;">0.030915</td>
<td style="text-align: center;">-0.007810</td>
<td style="text-align: center;">0.002234</td>
<td style="text-align: center;">0.001118</td>
<td style="text-align: center;">-0.000216</td>
<td style="text-align: center;">0.000730</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.000049</td>
<td style="text-align: center;">0.000289</td>
<td style="text-align: center;">0.000867</td>
<td style="text-align: center;">0.000206</td>
<td style="text-align: center;">0.000520</td>
<td style="text-align: center;">-0.007584</td>
<td style="text-align: center;">-0.007810</td>
<td style="text-align: center;">0.056988</td>
<td style="text-align: center;">-0.000550</td>
<td style="text-align: center;">-0.003409</td>
<td style="text-align: center;">0.000062</td>
<td style="text-align: center;">-0.001911</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.000095</td>
<td style="text-align: center;">0.000994</td>
<td style="text-align: center;">0.000940</td>
<td style="text-align: center;">0.001037</td>
<td style="text-align: center;">0.000245</td>
<td style="text-align: center;">-0.004730</td>
<td style="text-align: center;">0.002234</td>
<td style="text-align: center;">-0.000550</td>
<td style="text-align: center;">0.002432</td>
<td style="text-align: center;">0.000579</td>
<td style="text-align: center;">-0.000115</td>
<td style="text-align: center;">-0.001177</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.000049</td>
<td style="text-align: center;">0.002407</td>
<td style="text-align: center;">0.000694</td>
<td style="text-align: center;">0.000587</td>
<td style="text-align: center;">0.000062</td>
<td style="text-align: center;">-0.002688</td>
<td style="text-align: center;">0.001118</td>
<td style="text-align: center;">-0.003409</td>
<td style="text-align: center;">0.000579</td>
<td style="text-align: center;">0.003219</td>
<td style="text-align: center;">-0.000044</td>
<td style="text-align: center;">-0.000223</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-0.000077</td>
<td style="text-align: center;">0.000013</td>
<td style="text-align: center;">0.000182</td>
<td style="text-align: center;">0.000107</td>
<td style="text-align: center;">-0.000064</td>
<td style="text-align: center;">0.000284</td>
<td style="text-align: center;">-0.000216</td>
<td style="text-align: center;">0.000062</td>
<td style="text-align: center;">-0.000115</td>
<td style="text-align: center;">-0.000044</td>
<td style="text-align: center;">0.000084</td>
<td style="text-align: center;">0.000219</td>
</tr>
<tr class="even">
<td style="text-align: center;">-0.000026</td>
<td style="text-align: center;">-0.000587</td>
<td style="text-align: center;">-0.001085</td>
<td style="text-align: center;">-0.001053</td>
<td style="text-align: center;">-0.001263</td>
<td style="text-align: center;">0.001381</td>
<td style="text-align: center;">0.000730</td>
<td style="text-align: center;">-0.001911</td>
<td style="text-align: center;">-0.001177</td>
<td style="text-align: center;">-0.000223</td>
<td style="text-align: center;">0.000219</td>
<td style="text-align: center;">0.008304</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-57-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Both models percent not enough smooth in A and <span class="math inline">\(\Sigma\)</span>, but support our results in base models. Under extension models, the serial variance become variate over time and then the lNasdaq performance is much worse than the lgold. This provide a basic understanding of our current society, a high level of uncertainty and worse economies environment.</p>
</section>
</section>
</section>
<section id="conclusion" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Conclusion:</h1>
<p>In Conclusion, we could clearly see that there is a significant rising in log gold price in our BVARs models under different scenario. For next 24 periods, gold futures as a safe haven increase much more then Nasdaq Index, which treated as market returns in this research, and became flat (decrease in rate) in log price. Even the log Nasdaq Index in short run does not have a good performance, there still a strong increase in long run within 90% of confidence intervals. This quite reflects to the real world at this time, a boom of uncertainty and turn down of global economies.</p>
<p>However, due to lack of data sources and update, our predictions and forecasting are much behind of real world. Our theories still proved by results of real world and prove our reliable and robustness of our BVARs model.</p>
<p>In our models underling different scenarios assumptions, Gold still provide a strong safe-haven assets’ nature. That’s suggest the topic that Gold still is a good safe assets with evidence base. Those forecasting with 90% of confidence intervals provide a nature of current global economies: a high level of uncertainty and risk. This provide a sight for global investors for risk management.</p>
</section>
<section id="references" class="level1 unnumbered">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-stock2001" class="csl-entry" role="listitem">
Stock, James H, and Mark W Watson. 2001. <span>“Vector Autoregressions.”</span> <em>Journal of Economic Perspectives</em> 15 (4): 101–15. <a href="https://doi.org/10.1257/jep.15.4.101">https://doi.org/10.1257/jep.15.4.101</a>.
</div>
<div id="ref-wozniakBsvarsBayesianEstimation2022" class="csl-entry" role="listitem">
Woźniak, Tomasz. 2022. <em>Bsvars: Bayesian Estimation of Structural Vector Autoregressive Models</em>. R Package. <a href="https://cran.r-project.org/package=bsvars">https://cran.r-project.org/package=bsvars</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>